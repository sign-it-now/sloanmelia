<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light">
<title>SloanMelia â€” Sloan Smith Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=DM+Mono:wght@300;400;500&family=Jost:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<style>
:root {
  color-scheme: light only;
  --bg: #faf7f2;
  --ink: #0e0c09;
  --gold: #c8922a;
  --gold-light: #f0d090;
  --teal: #1a4a45;
  --cream: #f0ead8;
  --dim: #7a7060;
  --faint: #e5ddd0;
  --white: #ffffff;
  --green: #1a6a2a;
  --red: #9a1a1a;
  --blue: #1a3a7a;
  --purple: #5a1a9a;
  --sidebar-w: 240px;
}
@media (prefers-color-scheme: dark) { html,body { background:#faf7f2!important; color:#0e0c09!important; } }
*{margin:0;padding:0;box-sizing:border-box;}
html,body{background:#faf7f2!important;color:#0e0c09!important;font-family:'Jost',sans-serif;font-size:15px;line-height:1.6;min-height:100vh;}
#root{min-height:100vh;}

/* UTILS */
.mono{font-family:'DM Mono',monospace;}
.serif{font-family:'Playfair Display',serif;}
.gold{color:var(--gold);}
.dim{color:var(--dim);}
.flex{display:flex;}
.items-center{align-items:center;}
.gap1{gap:0.5rem;}
.gap2{gap:1rem;}
.gap3{gap:1.5rem;}
.w100{width:100%;}
.mt1{margin-top:0.5rem;}
.mt2{margin-top:1rem;}
.mt3{margin-top:1.5rem;}
.mb1{margin-bottom:0.5rem;}
.mb2{margin-bottom:1rem;}

/* BUTTONS */
.btn{font-family:'DM Mono',monospace;font-size:0.6rem;letter-spacing:0.15em;text-transform:uppercase;padding:0.65rem 1.4rem;border:none;cursor:pointer;transition:all 0.18s;display:inline-flex;align-items:center;gap:0.4rem;}
.btn-primary{background:var(--ink);color:var(--bg);}
.btn-primary:hover{background:var(--teal);}
.btn-gold{background:var(--gold);color:var(--ink);}
.btn-gold:hover{background:#a87020;}
.btn-outline{background:transparent;border:1px solid var(--ink);color:var(--ink);}
.btn-outline:hover{background:var(--ink);color:var(--bg);}
.btn-ghost{background:transparent;color:var(--dim);padding:0.4rem 0.8rem;font-size:0.58rem;}
.btn-ghost:hover{color:var(--ink);}
.btn-sm{padding:0.4rem 0.9rem;font-size:0.55rem;}
.btn-danger{background:#7a1a1a;color:#fff;}
.btn-danger:hover{background:#9a2a2a;}

/* INPUTS */
.input{width:100%;padding:0.65rem 0.9rem;border:1px solid var(--faint);background:var(--white);font-family:'Jost',sans-serif;font-size:0.88rem;color:var(--ink);outline:none;transition:border 0.18s;}
.input:focus{border-color:var(--gold);}
.input::placeholder{color:#b0a890;}
.label{font-family:'DM Mono',monospace;font-size:0.58rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--dim);display:block;margin-bottom:0.35rem;}
.select{width:100%;padding:0.65rem 0.9rem;border:1px solid var(--faint);background:var(--white);font-family:'Jost',sans-serif;font-size:0.88rem;color:var(--ink);outline:none;cursor:pointer;}
textarea.input{resize:vertical;min-height:80px;}

/* CARDS */
.card{background:var(--white);border:1px solid var(--faint);padding:1.2rem 1.4rem;}
.card-title{font-family:'Playfair Display',serif;font-size:1.05rem;font-weight:700;margin-bottom:0.3rem;}
.card-label{font-family:'DM Mono',monospace;font-size:0.55rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--gold);display:block;margin-bottom:0.2rem;}

/* BADGES */
.badge{font-family:'DM Mono',monospace;font-size:0.52rem;letter-spacing:0.1em;text-transform:uppercase;padding:0.2rem 0.6rem;display:inline-block;}
.badge-teal{background:#d0eae8;color:var(--teal);}
.badge-gold{background:#faecd0;color:#8a5a10;}
.badge-ink{background:#e8e0d8;color:var(--ink);}
.badge-green{background:#d0eaD0;color:var(--green);}
.badge-blue{background:#d0daea;color:var(--blue);}
.badge-purple{background:#e0d0ea;color:var(--purple);}
.badge-red{background:#ead0d0;color:var(--red);}
.badge-gray{background:#e8e0d8;color:var(--dim);}

/* TOASTS */
.toast-container{position:fixed;top:1rem;right:1rem;z-index:9999;display:flex;flex-direction:column;gap:0.5rem;}
.toast{padding:0.8rem 1.2rem;font-size:0.85rem;font-family:'DM Mono',monospace;font-size:0.62rem;letter-spacing:0.08em;animation:slideIn 0.2s ease;}
.toast-success{background:var(--green);color:#fff;}
.toast-error{background:var(--red);color:#fff;}
.toast-warn{background:var(--gold);color:var(--ink);}
@keyframes slideIn{from{transform:translateX(100%);opacity:0;}to{transform:translateX(0);opacity:1;}}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(14,12,9,0.7);z-index:1000;display:flex;align-items:center;justify-content:center;padding:1rem;}
.modal{background:var(--bg);max-width:600px;width:100%;max-height:90vh;overflow-y:auto;padding:2rem;}
.modal-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem;}
.modal-title{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700;}
.modal-close{background:none;border:none;font-size:1.2rem;cursor:pointer;color:var(--dim);line-height:1;}

/* SIDEBAR */
.sidebar{width:var(--sidebar-w);background:var(--ink);color:#e0d8d0;display:flex;flex-direction:column;min-height:100vh;flex-shrink:0;position:fixed;top:0;left:0;bottom:0;z-index:100;}
.sidebar-logo{padding:1.5rem 1.2rem 1rem;border-bottom:1px solid rgba(255,255,255,0.08);}
.sidebar-logo .monogram{width:36px;height:36px;background:var(--gold);color:var(--ink);font-family:'Playfair Display',serif;font-weight:900;font-size:1rem;display:flex;align-items:center;justify-content:center;margin-bottom:0.5rem;}
.sidebar-logo .app-name{font-family:'Playfair Display',serif;font-size:1rem;font-style:italic;color:#fff;}
.sidebar-logo .app-sub{font-family:'DM Mono',monospace;font-size:0.52rem;letter-spacing:0.12em;text-transform:uppercase;color:rgba(255,255,255,0.3);margin-top:0.1rem;}
.sidebar-nav{flex:1;padding:1rem 0;}
.nav-item{display:flex;align-items:center;gap:0.8rem;padding:0.7rem 1.2rem;cursor:pointer;font-size:0.88rem;color:rgba(255,255,255,0.55);transition:all 0.15s;border-left:3px solid transparent;}
.nav-item:hover{background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.9);}
.nav-item.active{background:rgba(200,146,42,0.12);color:#f0d090;border-left-color:var(--gold);}
.nav-item .nav-icon{font-size:1rem;width:20px;text-align:center;flex-shrink:0;}
.nav-item .nav-label{font-family:'DM Mono',monospace;font-size:0.6rem;letter-spacing:0.1em;text-transform:uppercase;}
.nav-item.coach-nav{background:rgba(200,146,42,0.08);}
.nav-item.coach-nav.active,.nav-item.coach-nav:hover{background:rgba(200,146,42,0.2);}
.sidebar-footer{padding:1rem 1.2rem;border-top:1px solid rgba(255,255,255,0.08);}
.sidebar-user{font-family:'DM Mono',monospace;font-size:0.58rem;letter-spacing:0.08em;color:rgba(255,255,255,0.3);margin-bottom:0.5rem;word-break:break-all;}

/* MAIN */
.main-area{margin-left:var(--sidebar-w);min-height:100vh;background:var(--bg);}
.page-header{padding:1.5rem 2rem 1rem;border-bottom:1px solid var(--faint);}
.page-title{font-family:'Playfair Display',serif;font-size:1.6rem;font-weight:700;}
.page-sub{font-family:'DM Mono',monospace;font-size:0.58rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--dim);margin-top:0.2rem;}
.page-content{padding:1.5rem 2rem;}

/* STAT CARDS */
.stats-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:1rem;margin-bottom:1.5rem;}
.stat-card{background:var(--white);border:1px solid var(--faint);padding:1.2rem;text-align:center;border-top:3px solid var(--ink);}
.stat-num{font-family:'Playfair Display',serif;font-size:2rem;font-weight:900;color:var(--gold);display:block;line-height:1;}
.stat-lbl{font-family:'DM Mono',monospace;font-size:0.52rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--dim);margin-top:0.3rem;display:block;}

/* GRID LAYOUTS */
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
.grid3{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;}

/* SECTION LABEL */
.section-label{font-family:'DM Mono',monospace;font-size:0.58rem;letter-spacing:0.18em;text-transform:uppercase;color:var(--gold);display:flex;align-items:center;gap:0.6rem;margin-bottom:0.8rem;}
.section-label::before{content:'';display:block;width:20px;height:1px;background:var(--gold);}

/* PROGRESS BAR */
.progress-bar{height:6px;background:var(--faint);overflow:hidden;}
.progress-fill{height:100%;background:var(--gold);transition:width 0.5s;}

/* TABS */
.tabs{display:flex;border-bottom:2px solid var(--faint);margin-bottom:1.5rem;}
.tab{font-family:'DM Mono',monospace;font-size:0.58rem;letter-spacing:0.12em;text-transform:uppercase;padding:0.7rem 1.2rem;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;color:var(--dim);transition:all 0.15s;}
.tab.active{color:var(--ink);border-bottom-color:var(--gold);}
.tab:hover:not(.active){color:var(--ink);}

/* CHAT */
.chat-area{display:flex;flex-direction:column;height:calc(100vh - 280px);min-height:400px;}
.chat-messages{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column;gap:0.8rem;background:var(--white);border:1px solid var(--faint);}
.chat-bubble{max-width:80%;padding:0.8rem 1rem;font-size:0.88rem;line-height:1.65;}
.chat-bubble.user{background:var(--ink);color:#faf7f2;align-self:flex-end;}
.chat-bubble.coach{background:var(--cream);color:var(--ink);align-self:flex-start;border:1px solid var(--faint);}
.chat-bubble.coach pre{white-space:pre-wrap;font-family:'DM Mono',monospace;font-size:0.78rem;background:rgba(0,0,0,0.05);padding:0.5rem;margin-top:0.4rem;}
.chat-input-row{display:flex;gap:0.5rem;margin-top:0.5rem;}
.chat-input{flex:1;padding:0.7rem 1rem;border:1px solid var(--faint);font-family:'Jost',sans-serif;font-size:0.9rem;outline:none;}
.chat-input:focus{border-color:var(--gold);}
.typing{display:flex;gap:0.3rem;align-items:center;padding:0.8rem 1rem;align-self:flex-start;}
.typing span{width:7px;height:7px;border-radius:50%;background:var(--gold);animation:bounce 1.2s infinite;}
.typing span:nth-child(2){animation-delay:0.2s;}
.typing span:nth-child(3){animation-delay:0.4s;}
@keyframes bounce{0%,80%,100%{transform:translateY(0);}40%{transform:translateY(-6px);}}

/* SETUP SCREEN */
.setup-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--bg);}
.setup-box{max-width:480px;width:100%;padding:2.5rem;background:var(--white);border:1px solid var(--faint);border-top:4px solid var(--gold);}
.setup-title{font-family:'Playfair Display',serif;font-size:1.8rem;font-weight:700;margin-bottom:0.3rem;}
.setup-title em{font-style:italic;color:var(--gold);}

/* LOGIN */
.login-screen{min-height:100vh;display:grid;grid-template-columns:1fr 1fr;}
.login-left{background:var(--ink);color:#faf7f2;display:flex;flex-direction:column;justify-content:center;padding:3rem;}
.login-right{display:flex;align-items:center;justify-content:center;padding:2rem;}
.login-box{width:100%;max-width:380px;}
.login-form-title{font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:700;margin-bottom:1.5rem;}

/* EMPTY STATE */
.empty-state{text-align:center;padding:3rem 1rem;color:var(--dim);}
.empty-icon{font-size:2.5rem;margin-bottom:0.8rem;opacity:0.4;}
.empty-text{font-family:'Playfair Display',serif;font-size:1rem;font-style:italic;margin-bottom:1rem;}

/* ACCORDION */
.accordion-item{border:1px solid var(--faint);margin-bottom:0.5rem;}
.accordion-header{padding:1rem 1.2rem;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-weight:600;font-size:0.92rem;}
.accordion-header:hover{background:var(--cream);}
.accordion-body{padding:0 1.2rem 1rem;font-size:0.88rem;line-height:1.7;color:#3a3020;}
.accordion-body ul{padding-left:1.2rem;margin-top:0.5rem;}
.accordion-body li{margin-bottom:0.3rem;}

/* SCROLLBAR */
::-webkit-scrollbar{width:6px;}
::-webkit-scrollbar-track{background:var(--faint);}
::-webkit-scrollbar-thumb{background:var(--dim);}

/* RESPONSIVE */
/* HAMBURGER BUTTON */
.hamburger{display:none;position:fixed;top:0.8rem;left:0.8rem;z-index:200;width:38px;height:38px;background:var(--ink);border:none;cursor:pointer;align-items:center;justify-content:center;flex-direction:column;gap:5px;padding:8px;}
.hamburger span{display:block;width:22px;height:2px;background:var(--gold);transition:all 0.2s;}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(14,12,9,0.5);z-index:99;}

@media(max-width:768px){
  .hamburger{display:flex;}
  .sidebar{transform:translateX(-100%);transition:transform 0.25s;}
  .sidebar.open{transform:translateX(0);}
  .sidebar-overlay.open{display:block;}
  .main-area{margin-left:0;padding-top:3rem;}
  .login-screen{grid-template-columns:1fr;}
  .login-left{display:none;}
  .grid2{grid-template-columns:1fr;}
}

.divider{border:none;border-top:1px solid var(--faint);margin:1.2rem 0;}
.copybox{background:var(--ink);color:#e0d8d0;font-family:'DM Mono',monospace;font-size:0.72rem;padding:1rem;overflow-x:auto;line-height:1.6;}
.info-box{background:var(--cream);border-left:4px solid var(--gold);padding:1rem 1.2rem;font-size:0.88rem;line-height:1.65;margin-bottom:1rem;}
.info-box strong{display:block;font-family:'DM Mono',monospace;font-size:0.55rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--gold);margin-bottom:0.3rem;}
</style>
<script>
// Pre-seed credentials
var SM_URL = 'https://gpktuflimoqeyxtwadsy.supabase.co';
var SM_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdwa3R1ZmxpbW9xZXl4dHdhZHN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2ODM2MDEsImV4cCI6MjA4NzI1OTYwMX0.q3RMeKEo17qXgt-a9ljtMfKJ46etHy4_rrj1cs64A4U';
var SM_COACH = 'https://gpktuflimoqeyxtwadsy.supabase.co/functions/v1/coach';
try{
  localStorage.setItem('sm_url', SM_URL);
  localStorage.setItem('sm_key', SM_KEY);
  localStorage.setItem('sm_coach', SM_COACH);
}catch(e){}
</script>
</head>
<body>
<div id="root"></div>

<script>
// â”€â”€ STUDY LIBRARY DATA â€” plain JS, no Babel needed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SOURCE CONFIG
const SRC = {
  OpenStax:   {label:'OpenStax',       badge:'badge-teal',  color:'var(--teal)'},
  LibreTexts: {label:'LibreTexts',     badge:'badge-blue',  color:'var(--blue)'},
  NOBA:       {label:'NOBA Project',   badge:'badge-purple',color:'var(--purple)'},
  Frontiers:  {label:'Frontiers OA',   badge:'badge-green', color:'var(--green)'},
  SSRN:       {label:'SSRN Free',      badge:'badge-ink',   color:'var(--ink)'},
  APA:        {label:'APA Official',   badge:'badge-gold',  color:'var(--gold)'},
  Tool:       {label:'Free Tool',      badge:'badge-gold',  color:'#c8922a'},
  Poster:     {label:'SloanMelia Ref', badge:'badge-teal',  color:'var(--teal)'},
};

// YEAR LEVELS
const YEARS = ['All','ğŸ“Œ Reference Posters','ğŸŒ± Freshman','ğŸŒ¿ Sophomore','ğŸŒ³ Junior','ğŸ“ Senior','ğŸ”¬ Master\'s','ğŸ›ï¸ Doctoral','âš¡ Research Tools'];
const YEAR_COLOR = {
  'ğŸ“Œ Reference Posters':'var(--teal)',
  'ğŸŒ± Freshman':         'var(--green)',
  'ğŸŒ¿ Sophomore':        '#2a7a4a',
  'ğŸŒ³ Junior':           'var(--teal)',
  'ğŸ“ Senior':           'var(--gold)',
  'ğŸ”¬ Master\'s':        'var(--blue)',
  'ğŸ›ï¸ Doctoral':         'var(--purple)',
  'âš¡ Research Tools':   '#c8922a',
};

const STUDY_TOPICS = [
// â”€â”€ REFERENCE POSTERS (16 built-in SloanMelia cards) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {id:1, year:'ğŸ“Œ Reference Posters', title:'Brain & Neuroscience', src:'Poster', url:'', desc:'The biological foundation of behavior, emotion, and criminal mind.',concepts:['Limbic system and emotional regulation','Prefrontal cortex and impulse control','Neuroplasticity and trauma','Brain imaging in forensic contexts','Psychopathy and brain differences','Neurotransmitters and behavior']},
  {id:2, year:'ğŸ“Œ Reference Posters', title:'DSM-5 Diagnostic Reference', src:'Poster', url:'', desc:'Mental disorder classification system used in forensic evaluations.',concepts:['Multiaxial assessment replaced by specifiers','Personality disorder clusters A/B/C','Psychotic disorder spectrum','Trauma and stressor-related disorders','Substance use disorder criteria','Malingering vs genuine disorder']},
  {id:3, year:'ğŸ“Œ Reference Posters', title:'Theorists Timeline', src:'Poster', url:'', desc:'From Freud to modern forensic psychology pioneers.',concepts:['Freud: unconscious and defense mechanisms','Skinner: behavioral reinforcement','Bandura: social learning theory','Kohlberg: moral development stages','Hare: psychopathy assessment (PCL-R)','Seligman: learned helplessness']},
  {id:4, year:'ğŸ“Œ Reference Posters', title:'Research Methods & Statistics', src:'Poster', url:'', desc:'Scientific foundation of psychological research.',concepts:['Experimental vs correlational design','Validity: internal and external','Reliability: test-retest, inter-rater','Statistical significance (p-value)','Effect size and practical significance','Ethical research principles (APA)']},
  {id:5, year:'ğŸ“Œ Reference Posters', title:'Defense Mechanisms', src:'Poster', url:'', desc:'Psychological defenses relevant to criminal behavior analysis.',concepts:['Repression: unconscious blocking','Rationalization: justifying actions','Projection: attributing to others','Denial: refusing to acknowledge','Displacement: redirecting emotion','Sublimation: channeling productively']},
  {id:6, year:'ğŸ“Œ Reference Posters', title:'Human Development', src:'Poster', url:'', desc:'Lifespan development theories critical to forensic assessment.',concepts:["Erikson's 8 psychosocial stages","Piaget's cognitive stages","Vygotsky's zone of proximal development",'Attachment theory (Bowlby)','Adverse childhood experiences (ACEs)','Adolescent brain development']},
  {id:7, year:'ğŸ“Œ Reference Posters', title:'Cognitive Biases', src:'Poster', url:'', desc:'How thinking errors affect judgment, perception, and testimony.',concepts:['Confirmation bias in investigation','Hindsight bias in evaluation','Availability heuristic','Anchoring effect in assessment','Eyewitness memory fallibility','Implicit bias in the justice system']},
  {id:8, year:'ğŸ“Œ Reference Posters', title:'APA Ethics Code', src:'Poster', url:'https://www.apa.org/ethics/code', desc:'Professional ethical obligations guiding all psychologists.',concepts:['Informed consent requirements','Confidentiality and its limits','Dual relationship avoidance','Competence boundaries','Accurate test reporting','Mandatory reporting obligations']},
  {id:9, year:'ğŸ“Œ Reference Posters', title:'Biology & Physiology', src:'Poster', url:'', desc:'Body systems that support psychological function.',concepts:['Autonomic nervous system responses','HPA axis and stress response','Sleep and mental health connection','Nutrition and brain function','Genetic influences on behavior','Immune-brain interactions']},
  {id:10,year:'ğŸ“Œ Reference Posters', title:'Sociology & Social Theory', src:'Poster', url:'', desc:'Social forces shaping criminal behavior and justice.',concepts:["Durkheim's anomie theory","Merton's strain theory",'Labeling theory and stigma','Social control theory','Intersectionality in justice','Recidivism and social factors']},
  {id:11,year:'ğŸ“Œ Reference Posters', title:'Philosophy of Mind', src:'Poster', url:'https://openstax.org/details/books/introduction-philosophy', desc:'Consciousness, free will, and moral responsibility.',concepts:['Determinism vs free will debate','Consciousness and self-awareness','Personal identity over time','Moral responsibility standards','The mind-body problem','Competency and culpability standards']},
  {id:12,year:'ğŸ“Œ Reference Posters', title:'Pharmacology Basics', src:'Poster', url:'', desc:'Psychoactive substances and their behavioral effects.',concepts:['CNS stimulants and depressants','Antipsychotic mechanisms','Antidepressant classes (SSRIs etc.)','Substance dependence physiology','Drug-induced psychosis','Medication compliance in forensic settings']},
  {id:13,year:'ğŸ“Œ Reference Posters', title:'Law & Psychology Interface', src:'Poster', url:'https://ssrn.com/en/index.cfm/psy/', desc:'How psychological science enters the legal system.',concepts:['Competency to stand trial standards','Criminal responsibility (mens rea)','Insanity defense standards','Risk assessment instruments','Expert witness role and limits','Miranda rights and interrogation psychology']},
  {id:14,year:'ğŸ“Œ Reference Posters', title:'Communication & Testimony', src:'Poster', url:'', desc:'Expert witness skills and forensic report writing.',concepts:['Report structure and objectivity','Cross-examination preparation','Translating jargon for juries','Daubert/Frye admissibility standards','Ethical boundaries in testimony','Non-verbal communication awareness']},
  {id:15,year:'ğŸ“Œ Reference Posters', title:'Academic Writing', src:'Poster', url:'https://socialsci.libretexts.org', desc:'Research paper and report writing standards for psychology.',concepts:['APA 7th edition formatting','Thesis statement construction','Literature review methodology','Citation and plagiarism rules','Abstract writing','Statistical results reporting']},
  {id:16,year:'ğŸ“Œ Reference Posters', title:'Program Administration', src:'Poster', url:'', desc:'Clinical and forensic program management fundamentals.',concepts:['HIPAA and confidentiality rules','Supervision and consultation ethics','Case documentation standards','Crisis intervention protocols','Team communication frameworks','Forensic unit security protocols']},

// â”€â”€ FRESHMAN YEAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {id:17,year:'ğŸŒ± Freshman',title:'Introduction to Psychology',src:'OpenStax',url:'https://openstax.org/details/books/psychology-2e',desc:'The gateway course. Brain, behavior, development, disorders, and DSM-5 overview. Foundation for everything forensic.',concepts:['Biological bases of behavior','States of consciousness','Learning theory','Memory and cognition','Psychological disorders overview','Social psychology basics']},
  {id:18,year:'ğŸŒ± Freshman',title:'Introduction to Sociology',src:'OpenStax',url:'https://openstax.org/details/books/introduction-sociology-3e',desc:'Social systems, crime, inequality, and the forces that shape human behavior. Essential criminology foundation.',concepts:["Durkheim's social facts",'Social stratification','Deviance and crime theory','Race, class, and gender','Social institutions','Socialization and identity']},
  {id:19,year:'ğŸŒ± Freshman',title:'Introduction to Statistics',src:'OpenStax',url:'https://openstax.org/details/books/introductory-statistics',desc:'The math language of psychology research. Every PhD defense uses statistics. Start here.',concepts:['Descriptive statistics','Probability foundations','Hypothesis testing','Confidence intervals','Chi-square and t-tests','Data visualization']},
  {id:20,year:'ğŸŒ± Freshman',title:'College Algebra',src:'OpenStax',url:'https://openstax.org/details/books/college-algebra-2e',desc:'The mathematical scaffolding beneath statistics, research design, and quantitative reasoning.',concepts:['Linear equations and functions','Polynomial and rational functions','Exponential and logarithmic functions','Systems of equations','Sequences and series','Matrix basics']},
  {id:21,year:'ğŸŒ± Freshman',title:'Introduction to Biology',src:'OpenStax',url:'https://openstax.org/details/books/concepts-biology',desc:'Cell biology, genetics, evolution, and body systems. Gateway to neuroscience and psychobiology.',concepts:['Cell structure and function','DNA, genes, and heredity','Evolution by natural selection','Nervous system basics','Hormones and endocrine system','Genetics and behavior']},
  {id:22,year:'ğŸŒ± Freshman',title:'Introduction to Philosophy',src:'OpenStax',url:'https://openstax.org/details/books/introduction-philosophy',desc:'Free will, moral responsibility, and consciousness â€” the philosophical spine of forensic psychology.',concepts:['Logic and argumentation','Free will vs. determinism','Moral responsibility','Consciousness and mind','Ethics foundations','Epistemology: how we know what we know']},
  {id:23,year:'ğŸŒ± Freshman',title:'U.S. History',src:'OpenStax',url:'https://openstax.org/details/books/us-history',desc:'The legal, social, and political context in which American criminal justice evolved. Essential background for mental health law.',concepts:['Constitutional foundations','Civil rights movements','Criminal justice history','Social reform movements','Federal vs. state law','Policy and legislation evolution']},
  {id:24,year:'ğŸŒ± Freshman',title:'English Composition & Academic Writing',src:'LibreTexts',url:'https://human.libretexts.org/Bookshelves/Composition',desc:'APA papers, dissertation chapters, and expert witness reports all require excellent writing. This is where it begins.',concepts:['Thesis and argument development','Evidence and citation','APA formatting basics','Research paper structure','Revision strategies','Academic voice and tone']},
  {id:25,year:'ğŸŒ± Freshman',title:'Introduction to Anthropology',src:'OpenStax',url:'https://openstax.org/details/books/introduction-anthropology',desc:'Human diversity, culture, and behavior across societies. Builds cultural competency essential for forensic practice.',concepts:['Four fields of anthropology','Cultural relativism','Human evolution','Language and communication','Social organization','Diversity and identity']},

// â”€â”€ SOPHOMORE YEAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {id:26,year:'ğŸŒ¿ Sophomore',title:'Research Methods in Psychology',src:'LibreTexts',url:'https://socialsci.libretexts.org/Bookshelves/Psychology/Research_Methods_in_Psychology',desc:'The scientific method applied to human behavior. Required for every graduate program in the country.',concepts:['Experimental design','Correlational research','Survey methods','Ethical research standards','Reliability and validity','IRB and participant protection']},
  {id:27,year:'ğŸŒ¿ Sophomore',title:'Lifespan Developmental Psychology',src:'OpenStax',url:'https://openstax.org/details/books/lifespan-development',desc:"Erikson, Piaget, Vygotsky, ACEs, adolescent brain â€” explains criminal behavior patterns across a person's entire life.",concepts:["Erikson's psychosocial stages","Piaget's cognitive development",'Attachment theory (Bowlby)','Adverse childhood experiences (ACEs)','Adolescent brain and risk-taking','Aging and neurological change']},
  {id:28,year:'ğŸŒ¿ Sophomore',title:'Abnormal Psychology',src:'NOBA',url:'https://nobaproject.com/textbooks/introduction-to-psychology-the-full-noba-collection',desc:'The DSM-5 in clinical depth. Turns reference-poster knowledge into real understanding of diagnosis and treatment.',concepts:['Anxiety and mood disorders','Psychotic spectrum disorders','Personality disorders in depth','Trauma-related disorders','Neurodevelopmental disorders','Differential diagnosis basics']},
  {id:29,year:'ğŸŒ¿ Sophomore',title:'Behavioral Neuroscience',src:'OpenStax',url:'https://openstax.org/details/books/introduction-behavioral-neuroscience',desc:'Brain-behavior relationships, neuroimaging, psychopathy neuroscience. The biological lens for all forensic work.',concepts:['Neuron structure and function','Nervous system organization','Sensation and perception','Stress and the brain','Sleep and biological rhythms','Psychopathology and the brain']},
  {id:30,year:'ğŸŒ¿ Sophomore',title:'Anatomy & Physiology',src:'OpenStax',url:'https://openstax.org/details/books/anatomy-and-physiology-2e',desc:'Body systems, nervous system deep-dive, hormones, and pharmacology foundations required for advanced courses.',concepts:['Nervous system anatomy','Endocrine system and hormones','Cardiovascular system','Immune system basics','Sensory systems','Reproductive system basics']},
  {id:31,year:'ğŸŒ¿ Sophomore',title:'Introduction to Criminal Justice',src:'LibreTexts',url:'https://crimj.libretexts.org/Bookshelves/Introduction_to_Criminal_Justice',desc:'The system Sloan will spend her career working inside. Courts, corrections, law enforcement, policy.',concepts:['History of criminal justice','Police and law enforcement','Court system and prosecution','Corrections and incarceration','Juvenile justice system','Criminal justice policy']},
  {id:32,year:'ğŸŒ¿ Sophomore',title:'Social Psychology',src:'NOBA',url:'https://nobaproject.com/modules/social-psychology',desc:'Conformity, obedience, group dynamics, prejudice. The psychological forces operating in criminal and courtroom behavior.',concepts:['Attitude formation and change','Social influence and conformity','Obedience to authority (Milgram)','Group dynamics and groupthink','Prejudice and stereotyping','Prosocial behavior and altruism']},
  {id:33,year:'ğŸŒ¿ Sophomore',title:'Introduction to Criminology',src:'LibreTexts',url:'https://crimj.libretexts.org/Bookshelves/Criminology',desc:'Why people commit crime. Strain theory, labeling theory, rational choice â€” the theoretical backbone of forensic practice.',concepts:['Classical and positivist criminology','Strain and anomie theories','Labeling and social reaction','Rational choice theory','Biological theories of crime','Feminist criminology']},

// â”€â”€ JUNIOR YEAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {id:34,year:'ğŸŒ³ Junior',title:'Forensic Psychology: Introduction',src:'LibreTexts',url:'https://socialsci.libretexts.org/Bookshelves/Psychology/Forensic_Psychology',desc:'The first dedicated forensic course. Competency, criminal responsibility, risk assessment at survey level.',concepts:['History of forensic psychology','Competency to stand trial','Criminal responsibility assessment','Civil forensic applications','Juvenile forensic evaluation','Expert witness foundations']},
  {id:35,year:'ğŸŒ³ Junior',title:'Cognitive Psychology',src:'NOBA',url:'https://nobaproject.com/modules/cognitive-psychology',desc:'Memory, attention, decision-making, eyewitness reliability â€” directly applicable to court testimony and evidence evaluation.',concepts:['Memory encoding and retrieval','Eyewitness memory fallibility','Attention and perception','Executive function','Language and thought','Decision-making and judgment']},
  {id:36,year:'ğŸŒ³ Junior',title:'Personality Theories',src:'LibreTexts',url:'https://socialsci.libretexts.org/Bookshelves/Psychology/Personality_Psychology',desc:'Why people are who they are. The theoretical foundation for criminal profiling and offender assessment.',concepts:['Psychoanalytic theories','Trait theories (Big Five)','Humanistic psychology','Behavioral and social learning','Personality disorders','PCL-R and dark triad traits']},
  {id:37,year:'ğŸŒ³ Junior',title:'Psychopharmacology',src:'LibreTexts',url:'https://med.libretexts.org/Bookshelves/Pharmacology_and_Neuroscience',desc:'How substances alter psychology and behavior. Critical for substance disorder cases, medication compliance, and toxicology.',concepts:['Pharmacokinetics basics','CNS depressants and stimulants','Antipsychotic medications','Antidepressants and mood stabilizers','Substance use disorders','Drug-induced psychosis']},
  {id:38,year:'ğŸŒ³ Junior',title:'Advanced Statistics for Behavioral Sciences',src:'OpenStax',url:'https://openstax.org/details/books/introductory-statistics',desc:'ANOVA, regression, effect size â€” the quantitative skills required for graduate school admission and research.',concepts:['Analysis of Variance (ANOVA)','Multiple regression','Factor analysis','Non-parametric tests','Effect size and power','Statistical software (JASP/SPSS)']},
  {id:39,year:'ğŸŒ³ Junior',title:'Learning & Behavior',src:'LibreTexts',url:'https://socialsci.libretexts.org/Bookshelves/Psychology/Behavioral_Psychology',desc:'Classical and operant conditioning, behavioral modification. Foundation for correctional psychology interventions.',concepts:['Classical conditioning (Pavlov)','Operant conditioning (Skinner)','Reinforcement schedules','Observational learning','Behavioral modification','Token economies in corrections']},
  {id:40,year:'ğŸŒ³ Junior',title:'Law & Psychology: Advanced',src:'SSRN',url:'https://ssrn.com/en/index.cfm/psy/',desc:'Miranda rights, interrogation psychology, Daubert standards, expert witness admissibility. Free peer-reviewed papers on SSRN.',concepts:['Miranda rights and false confessions','Interrogation psychology','Daubert and Frye standards','Expert testimony admissibility','Jury psychology and decision-making','Trial consultant roles']},
  {id:41,year:'ğŸŒ³ Junior',title:'Multicultural Psychology',src:'OpenStax',url:'https://openstax.org/details/books/introduction-anthropology',desc:'Cultural competency in forensic practice. Intersectionality in the justice system. Required for ethical forensic work.',concepts:['Cultural humility and competence','Intersectionality of identities','Race and the justice system','Culturally valid assessment','Bias in psychological testing','Advocacy and social justice']},

// â”€â”€ SENIOR YEAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {id:42,year:'ğŸ“ Senior',title:'Psychological Testing & Assessment',src:'LibreTexts',url:'https://socialsci.libretexts.org/Bookshelves/Psychology/Psychological_Testing_and_Assessment',desc:'Intelligence tests, personality inventories, projective tests, malingering detection. Foundation for forensic evaluations.',concepts:['Reliability and validity in testing','Intelligence testing (WAIS)','Personality inventories (MMPI-2-RF)','Neuropsychological screening','Malingering and response bias','Forensic report writing']},
  {id:43,year:'ğŸ“ Senior',title:'APA Ethics Code (Full Text)',src:'APA',url:'https://www.apa.org/ethics/code',desc:"APA's complete ethical code â€” free and required reading. Every forensic psychologist lives by this document.",concepts:['General principles (5 core)','Informed consent standards','Confidentiality and privilege','Multiple relationships','Assessment ethics','Forensic activities standards']},
  {id:44,year:'ğŸ“ Senior',title:'Advanced Psychopathology',src:'Frontiers',url:'https://www.frontiersin.org/journals/psychiatry',desc:'DSM-5 in clinical depth, case conceptualization, differential diagnosis in forensic contexts. Open access journal.',concepts:['Complex differential diagnosis','Personality pathology in forensic settings','Psychosis and criminal behavior','Trauma and dissociation','Malingering vs. genuine disorder','Neurodevelopmental disorders in justice']},
  {id:45,year:'ğŸ“ Senior',title:'Psychopathology & Criminal Behavior',src:'SSRN',url:'https://ssrn.com/en/index.cfm/psy/',desc:'The bridge between clinical diagnosis and criminal behavior. Free working papers from leading researchers.',concepts:['Antisocial personality disorder','Psychopathy and recidivism','Mental illness and violence myth','Substance disorders and crime','Competency and criminal responsibility','Risk assessment instruments']},
  {id:46,year:'ğŸ“ Senior',title:'Research Design & Thesis Preparation',src:'LibreTexts',url:'https://socialsci.libretexts.org/Bookshelves/Psychology/Research_Methods_in_Psychology',desc:'How to design studies that become dissertation chapters. Research questions, IRB, methodology selection.',concepts:['Literature review methodology','Research question formulation','IRB application process','Qualitative vs. quantitative methods','Mixed methods design','Academic writing and APA 7th ed.']},
  {id:47,year:'ğŸ“ Senior',title:'Abnormal Psychology: Special Populations',src:'NOBA',url:'https://nobaproject.com/modules/disorders-of-childhood',desc:'Children, adolescents, elderly, and incarcerated populations in psychological assessment and treatment.',concepts:['Childhood and adolescent disorders','Geriatric psychopathology','Intellectual and developmental disabilities','Forensic assessment of special populations','Cultural considerations','Trauma in special populations']},

// â”€â”€ MASTER'S LEVEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {id:48,year:"ğŸ”¬ Master's",title:'Forensic Assessment & Evaluation',src:'SSRN',url:'https://ssrn.com/en/index.cfm/psy/',desc:'PCL-R, HCR-20, MMPI-2-RF, STATIC-99 in forensic contexts. Free peer-reviewed working papers.',concepts:['Competency to stand trial (CAST-MR)','Criminal responsibility (MSE)','PCL-R psychopathy assessment','Violence risk: HCR-20, VRAG','Sex offender risk: STATIC-99','Neuropsychological battery in forensics']},
  {id:49,year:"ğŸ”¬ Master's",title:'Advanced Psychopathology Graduate',src:'Frontiers',url:'https://www.frontiersin.org/journals/psychiatry',desc:'Current clinical research on disorders seen in forensic populations. Open access, new papers published weekly.',concepts:['Severe mental illness in forensic settings','Personality disorders in offender populations','Trauma spectrum in justice-involved','Neurodevelopmental disorders and culpability','Substance use co-occurring disorders','Treatment-resistant conditions']},
  {id:50,year:"ğŸ”¬ Master's",title:'Risk Assessment & Violence Prediction',src:'SSRN',url:'https://ssrn.com/en/index.cfm/psy/',desc:'Actuarial vs. structured professional judgment. SVP evaluations. The science and limits of predicting danger.',concepts:['Historical-Clinical-Risk (HCR-20 V3)','Violence Risk Appraisal Guide (VRAG)','Static vs. dynamic risk factors','Sex offender risk instruments','Protective factors (SAPROF)','Base rates and decision-making']},
  {id:51,year:"ğŸ”¬ Master's",title:'Mental Health Law',src:'SSRN',url:'https://papers.ssrn.com/sol3/topten/topTenResults.cfm?groupingId=2659941&netorjrnl=jrnl',desc:'Case law, competency standards, civil commitment, NGRI. The legal scaffolding of forensic practice.',concepts:['Competency to stand trial: Dusky standard','NGRI: M\'Naghten and ALI tests','Civil commitment standards','Outpatient commitment laws','HIPAA and privileged communication','ADA and disability in court']},
  {id:52,year:"ğŸ”¬ Master's",title:'Juvenile Forensic Psychology',src:'Frontiers',url:'https://www.frontiersin.org/journals/child-and-adolescent-psychiatry',desc:'Adolescent brain science, juvenile justice system, developmental considerations in criminal responsibility.',concepts:['Adolescent brain immaturity (Roper v. Simmons)','Juvenile competency standards','Transfer to adult court assessment','Restorative justice for youth','Risk assessment for juveniles (YLS/CMI)','Trauma-informed juvenile justice']},
  {id:53,year:"ğŸ”¬ Master's",title:'Trauma & Crisis Intervention',src:'Frontiers',url:'https://www.frontiersin.org/journals/psychology',desc:'PTSD, complex trauma, victim psychology, crisis evaluation. Open access research from Frontiers in Psychology.',concepts:['PTSD diagnostic criteria','Complex trauma and C-PTSD','Trauma-informed care principles','Crisis intervention models','Victim assessment and support','Secondary traumatic stress in practitioners']},
  {id:54,year:"ğŸ”¬ Master's",title:'Expert Witness Testimony & Report Writing',src:'APA',url:'https://www.apa.org/about/division/div41',desc:'How to write a report a judge will actually read. How to survive cross-examination. APA Division 41 guidelines.',concepts:['Forensic report structure and standards','Objectivity vs. advocacy','Direct examination techniques','Cross-examination preparation','Daubert challenges','Communicating science to laypersons']},
  {id:55,year:"ğŸ”¬ Master's",title:'Correctional Psychology',src:'Frontiers',url:'https://www.frontiersin.org/journals/psychology',desc:'Treatment in prison settings, recidivism reduction, rehabilitation research. What actually works behind bars.',concepts:['Risk-Need-Responsivity model','Cognitive behavioral treatment (CBT)','Therapeutic communities','Reentry and recidivism','Special housing units (SHU) psychology','Correctional staff mental health']},
  {id:56,year:"ğŸ”¬ Master's",title:'Advanced Research Methods (Graduate)',src:'LibreTexts',url:'https://socialsci.libretexts.org/Bookshelves/Psychology/Research_Methods_in_Psychology',desc:'Multivariate analysis, structural equation modeling, meta-analysis. The quantitative tools of original research.',concepts:['Multiple regression and ANCOVA','Factor analysis','Structural equation modeling (SEM)','Meta-analysis methodology','Mixed methods integration','Grant proposal writing']},

// â”€â”€ DOCTORAL LEVEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {id:57,year:'ğŸ›ï¸ Doctoral',title:'Dissertation Research Design',src:'LibreTexts',url:'https://socialsci.libretexts.org/Bookshelves/Psychology/Research_Methods_in_Psychology',desc:'Designing original studies that advance the field. Research questions, IRB, literature review, methodology.',concepts:['Forming an original research question','Systematic literature review','IRB and human subjects protection','Dissertation proposal structure','Methodology: quant vs. qual vs. mixed','Defending a research design']},
  {id:58,year:'ğŸ›ï¸ Doctoral',title:'Advanced Quantitative Methods',src:'Tool',url:'https://jasp-stats.org',desc:'Bayesian statistics, multivariate analysis, JASP software (free). The actual computational tools of dissertation research.',concepts:['Bayesian vs. frequentist statistics','JASP: free SPSS alternative','Multilevel modeling','Longitudinal data analysis','Structural equation modeling','Open science and reproducibility']},
  {id:59,year:'ğŸ›ï¸ Doctoral',title:'Neuropsychological Assessment',src:'Frontiers',url:'https://www.frontiersin.org/journals/human-neuroscience',desc:'Brain-behavior relationships in forensic populations. TBI and criminal responsibility. Open access journal.',concepts:['Neuropsychological battery selection','Traumatic brain injury assessment','Malingering detection (TOMM, VSVT)','TBI and criminal responsibility','Dementia and competency','Neuroimaging in legal proceedings']},
  {id:60,year:'ğŸ›ï¸ Doctoral',title:'Police Psychology',src:'SSRN',url:'https://ssrn.com/en/index.cfm/psy/',desc:'Pre-employment evaluation, fitness for duty, officer-involved shootings, PTSD in law enforcement.',concepts:['Pre-employment psychological evaluation','Fitness for duty evaluation','Stress and PTSD in officers','Crisis negotiation psychology','Use of force decision-making','Organizational psychology in police']},
  {id:61,year:'ğŸ›ï¸ Doctoral',title:'Forensic Seminar: Cutting-Edge Research',src:'SSRN',url:'https://psyarxiv.com',desc:'PsyArXiv preprints â€” where new forensic psychology research appears 12-18 months before journal publication.',concepts:['Current research in forensic assessment','Emerging risk instruments','Deception detection research','False confession research','Eyewitness reform research','AI and forensic psychology']},
  {id:62,year:'ğŸ›ï¸ Doctoral',title:'Teaching Psychology at the University Level',src:'APA',url:'https://www.apa.org/about/division/div2',desc:'Pedagogy, course design, and academic career development for future forensic psychology professors.',concepts:['Course design and learning objectives','Evidence-based teaching methods','Student assessment strategies','Academic publishing and research','Academic job market','Mentoring and advising students']},
  {id:63,year:'ğŸ›ï¸ Doctoral',title:'Consultation & Supervision',src:'APA',url:'https://www.apa.org/about/division/div41',desc:'Supervising trainees, consulting with attorneys and courts, organizational consultation in justice settings.',concepts:['Ethical supervision models','Consultation with legal professionals','Organizational consultation','Supervision documentation','Peer consultation and collegial review','Professional development and self-care']},

// â”€â”€ RESEARCH TOOLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {id:64,year:'âš¡ Research Tools',title:'PsyArXiv â€” Psychology Preprints',src:'Tool',url:'https://psyarxiv.com',desc:'Where forensic psychology research appears 12-18 months before peer-reviewed publication. The bleeding edge of the field. Free.',concepts:['Search "forensic psychology" for latest work','Filter by date to see what\'s newest','Download PDFs of any preprint free','Follow researchers in your area','Comment and engage with authors','Understand the research pipeline']},
  {id:65,year:'âš¡ Research Tools',title:'PubPsych â€” Free Research Database',src:'Tool',url:'https://www.pubpsych.eu',desc:'Large freely accessible psychological reference database â€” journal articles, books, research data, and test instruments. Filter by open access.',concepts:['Search all areas of psychology','Filter results to open access only','Access test instruments and measures','Find book chapters and reviews','Multi-language coverage','Links to full-text when available']},
  {id:66,year:'âš¡ Research Tools',title:'Frontiers in Psychology â€” Open Access Journal',src:'Frontiers',url:'https://www.frontiersin.org/journals/psychology',desc:'Major open access journal â€” 28 sections including forensic, clinical, neuroscience, and quantitative methods. Set up email alerts.',concepts:['Set email alerts for "forensic psychology"','28 subsections covering all specialties','100% free to read all articles','Download PDFs of any article','Filter by article type (review vs. research)','Find recent meta-analyses in your area']},
  {id:67,year:'âš¡ Research Tools',title:'Google Scholar â€” Smart Search Setup',src:'Tool',url:'https://scholar.google.com',desc:'Set up weekly email alerts for "forensic psychology" and "forensic assessment." Delivers new papers directly to your inbox.',concepts:['Create alerts for key search terms','Search "cite:" to find all papers citing one','Use "since 2023" to find recent work','Find free PDF versions of any paper','Build your own library in My Library','Follow top researchers in forensics']},
  {id:68,year:'âš¡ Research Tools',title:'SSRN â€” Psychology Working Papers',src:'SSRN',url:'https://ssrn.com/en/index.cfm/psy/',desc:'Social Science Research Network: law professors and forensic psychologists post free papers before formal publication.',concepts:['Browse forensic psychology section','Download working papers for free','Law-psychology interface papers','Pre-publication research access','Author profiles and contact info','Legal scholarship on mental health law']},
  {id:69,year:'âš¡ Research Tools',title:'NOBA Project â€” Free Psychology Modules',src:'NOBA',url:'https://nobaproject.com',desc:'Peer-reviewed, modular psychology textbook written by world-class professors. Fills every gap OpenStax misses. Completely free.',concepts:['Modular: pick any topic you need','Written by leading university professors','Companion to textbook learning','Covers clinical, social, developmental','Downloadable PDFs of each module','Used in 500+ university courses']},
  {id:70,year:'âš¡ Research Tools',title:'JASP â€” Free Statistical Software',src:'Tool',url:'https://jasp-stats.org',desc:'Free, open-source statistics software that rivals SPSS. The tool forensic psychology researchers actually use. Learn it now.',concepts:['Download free for Mac and PC','Bayesian and frequentist analyses','Built-in APA-format output','Factor analysis and SEM','ANOVA, regression, t-tests','Learning resources and tutorials built in']},
  {id:71,year:'âš¡ Research Tools',title:'Zotero â€” Free Citation Manager',src:'Tool',url:'https://www.zotero.org',desc:'Captures articles from any database and organizes them into a searchable personal library. Indispensable for dissertation research.',concepts:['Browser extension captures papers instantly','Auto-generates APA citations','Organize into folders by topic','Syncs across all your devices','Group libraries for collaboration','Integrates with Word for bibliography']},
  {id:72,year:'âš¡ Research Tools',title:'APA Division 41 â€” Psychology & Law',src:'APA',url:'https://ap-ls.org',desc:'American Psychology-Law Society: free guidelines, ethical standards, and professional resources for practicing forensic psychologists.',concepts:['Free access to AP-LS newsletters','Graduate student resources and awards','Fellowship and grant opportunities','Annual conference and networking','Forensic specialty guidelines (free PDF)','Early career psychologist programs']},
  {id:73,year:'âš¡ Research Tools',title:'LibreTexts Psychology Collection',src:'LibreTexts',url:'https://socialsci.libretexts.org/Bookshelves/Psychology',desc:'Over 100 free, openly licensed psychology textbooks covering every subfield from intro to advanced graduate level.',concepts:['Browse all psychology textbooks free','Download any book as PDF','Search across all books simultaneously','Annotation tools built in','Instructor ancillaries available','Covers all years freshman to doctoral']},
  {id:74,year:'âš¡ Research Tools',title:'OpenStax Full Library',src:'OpenStax',url:'https://openstax.org/subjects',desc:'50+ peer-reviewed free college textbooks from Rice University. The gold standard of open educational resources.',concepts:['Psychology 2e and Introductory Psych','Sociology, Statistics, Anatomy & Physiology','Lifespan Development (2024 edition)','Behavioral Neuroscience (new)','Download PDF, read online, or order print','Instructor resources: slides and test banks']},
];

// YEAR level styling helpers
const YEAR_BADGE = {
  'ğŸ“Œ Reference Posters': 'badge-teal',
  'ğŸŒ± Freshman':          'badge-green',
  'ğŸŒ¿ Sophomore':         'badge-green',
  'ğŸŒ³ Junior':            'badge-teal',
  'ğŸ“ Senior':            'badge-gold',
  "ğŸ”¬ Master's":          'badge-blue',
  'ğŸ›ï¸ Doctoral':          'badge-purple',
  'âš¡ Research Tools':    'badge-gold',
};

</script>

<script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;

// â”€â”€ SUPABASE CLIENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Client created in plain <script> tag to avoid window.supabase naming conflict
let _smClient = null;
function getSupabase() { return _smClient; }
function getAnonKey() {
  // Use the anon key for edge function auth - simpler and more reliable than session JWT
  return localStorage.getItem('sm_key') || '';
}
function initSupabase(url, key) {
  if (_smClient) return _smClient;
  // window.supabase is set by the UMD CDN script (var supabase = ...)
  // We access it via window to avoid shadowing by Babel's 'let supabase'
  const lib = window['supabase'];
  if (!lib || !lib.createClient) {
    throw new Error('Supabase CDN not loaded. Check network tab for CDN errors.');
  }
  _smClient = lib.createClient(url, key);
  return _smClient;
}

// â”€â”€ TOAST SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ToastContainer({ toasts }) {
  return (
    <div className="toast-container">
      {toasts.map(t => (
        <div key={t.id} className={`toast toast-${t.type}`}>{t.msg}</div>
      ))}
    </div>
  );
}
function useToast() {
  const [toasts, setToasts] = useState([]);
  const add = (msg, type='success') => {
    const id = Date.now();
    setToasts(p => [...p, {id, msg, type}]);
    setTimeout(() => setToasts(p => p.filter(t => t.id !== id)), 3500);
  };
  return { toasts, toast: add };
}

// â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Modal({ open, onClose, title, children, wide }) {
  if (!open) return null;
  return (
    <div className="modal-overlay" onClick={onClose}>
      <div className="modal" style={wide?{maxWidth:800}:{}} onClick={e=>e.stopPropagation()}>
        <div className="modal-header">
          <div className="modal-title serif">{title}</div>
          <button className="modal-close" onClick={onClose}>âœ•</button>
        </div>
        {children}
      </div>
    </div>
  );
}

// â”€â”€ DAYS UNTIL GRADUATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function daysUntil(dateStr) {
  const target = new Date(dateStr);
  const now = new Date();
  return Math.ceil((target - now) / (1000*60*60*24));
}

// â”€â”€ SETUP SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SetupScreen({ onSetup }) {
  const [url, setUrl] = useState('');
  const [key, setKey] = useState('');
  const [coachUrl, setCoachUrl] = useState('');
  const [err, setErr] = useState('');

  const stored = () => {
    const u = localStorage.getItem('sm_url');
    const k = localStorage.getItem('sm_key');
    const c = localStorage.getItem('sm_coach');
    if(u&&k) { setUrl(u); setKey(k); setCoachUrl(c||''); }
  };
  useEffect(stored, []);

  const save = () => {
    if(!url.trim()||!key.trim()) { setErr('Supabase URL and Anon Key are required.'); return; }
    localStorage.setItem('sm_url', url.trim());
    localStorage.setItem('sm_key', key.trim());
    localStorage.setItem('sm_coach', coachUrl.trim());
    initSupabase(url.trim(), key.trim());
    onSetup({ url: url.trim(), key: key.trim(), coachUrl: coachUrl.trim() });
  };

  return (
    <div className="setup-screen">
      <div className="setup-box">
        <div style={{marginBottom:'1.5rem'}}>
          <div className="mono" style={{fontSize:'0.58rem',letterSpacing:'0.2em',textTransform:'uppercase',color:'var(--gold)',marginBottom:'0.5rem'}}>First Time Setup</div>
          <h1 className="setup-title">Sloan<em>Melia</em></h1>
          <p style={{color:'var(--dim)',fontSize:'0.88rem',marginTop:'0.3rem'}}>Enter your Supabase credentials to get started. Find these in your Supabase project â†’ Settings â†’ API.</p>
        </div>

        <div className="mb2">
          <label className="label">Supabase Project URL *</label>
          <input className="input" value={url} onChange={e=>setUrl(e.target.value)} placeholder="https://your-project.supabase.co"/>
        </div>
        <div className="mb2">
          <label className="label">Supabase Anon (Public) Key *</label>
          <input className="input" value={key} onChange={e=>setKey(e.target.value)} placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6Ikp..."/>
        </div>
        <div className="mb2">
          <label className="label">Coach Edge Function URL (optional â€” add later)</label>
          <input className="input" value={coachUrl} onChange={e=>setCoachUrl(e.target.value)} placeholder="https://your-project.supabase.co/functions/v1/coach"/>
          <div style={{fontSize:'0.75rem',color:'var(--dim)',marginTop:'0.3rem'}}>The AI Coach works once you deploy the Edge Function. You can skip this and add it later in the Coach module.</div>
        </div>

        {err && <div style={{color:'var(--red)',fontSize:'0.82rem',marginBottom:'0.8rem'}}>{err}</div>}
        <button className="btn btn-gold w100" onClick={save}>Launch SloanMelia â†’</button>

        <div style={{marginTop:'1.5rem',borderTop:'1px solid var(--faint)',paddingTop:'1rem'}}>
          <div style={{fontSize:'0.75rem',color:'var(--dim)',lineHeight:1.6}}>
            <strong style={{display:'block',marginBottom:'0.3rem'}}>Don't have Supabase yet?</strong>
            1. Go to <strong>supabase.com</strong> â†’ New Project<br/>
            2. Name it <strong>sloanmelia</strong><br/>
            3. Go to Project Settings â†’ API<br/>
            4. Copy the Project URL and anon key above
          </div>
        </div>
      </div>
    </div>
  );
}

// â”€â”€ LOGIN SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function LoginScreen({ onLogin, toast }) {
  const [email, setEmail] = useState('');
  const [pw, setPw] = useState('');
  const [mode, setMode] = useState('login'); // login | signup
  const [loading, setLoading] = useState(false);

  const submit = async () => {
    if(!email||!pw) return;
    setLoading(true);
    try {
      const sb = getSupabase();
      let res;
      if(mode==='login') {
        res = await sb.auth.signInWithPassword({email, password:pw});
      } else {
        res = await sb.auth.signUp({email, password:pw});
      }
      if(res.error) { toast(res.error.message,'error'); }
      else { 
        if(mode==='signup') toast('Account created! Check email to verify.','success');
        else onLogin(res.data.user);
      }
    } catch(e) { toast('Connection error. Check your Supabase credentials.','error'); }
    setLoading(false);
  };

  return (
    <div className="login-screen">
      <div className="login-left">
        <div style={{marginBottom:'1rem'}}>
          <div className="mono" style={{fontSize:'0.55rem',letterSpacing:'0.25em',textTransform:'uppercase',color:'rgba(200,146,42,0.8)',marginBottom:'1rem'}}>sloanmelia.com</div>
          <div style={{fontFamily:'Playfair Display, serif',fontSize:'3rem',fontWeight:900,lineHeight:1.05,marginBottom:'0.5rem'}}>
            Sloan<br/><em style={{color:'var(--gold)'}}>Melia</em>
          </div>
          <div style={{fontFamily:'Playfair Display, serif',fontStyle:'italic',fontSize:'1.1rem',color:'rgba(255,255,255,0.5)',marginBottom:'2rem'}}>From Senior Year to Dr. Smith</div>
        </div>
        <div style={{display:'flex',flexDirection:'column',gap:'0.8rem'}}>
          {['AI College Coach','Document Vault','College Tracker','Financial Aid Hub','Study Library'].map(f=>(
            <div key={f} style={{display:'flex',alignItems:'center',gap:'0.7rem',fontSize:'0.85rem',color:'rgba(255,255,255,0.6)'}}>
              <span style={{color:'var(--gold)'}}>âœ“</span> {f}
            </div>
          ))}
        </div>
      </div>
      <div className="login-right">
        <div className="login-box">
          <div style={{marginBottom:'1.5rem'}}>
            <div className="mono" style={{fontSize:'0.55rem',letterSpacing:'0.18em',textTransform:'uppercase',color:'var(--gold)',marginBottom:'0.4rem'}}>
              {mode==='login'?'Welcome Back':'Create Account'}
            </div>
            <h2 className="login-form-title serif">{mode==='login'?'Sign In':'Get Started'}</h2>
          </div>

          <div className="mb2">
            <label className="label">Email</label>
            <input className="input" type="email" value={email} onChange={e=>setEmail(e.target.value)} placeholder="sloan@sloanmelia.com" onKeyDown={e=>e.key==='Enter'&&submit()}/>
          </div>
          <div className="mb2">
            <label className="label">Password</label>
            <input className="input" type="password" value={pw} onChange={e=>setPw(e.target.value)} placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onKeyDown={e=>e.key==='Enter'&&submit()}/>
          </div>

          <button className="btn btn-primary w100 mt1" onClick={submit} disabled={loading} style={{justifyContent:'center'}}>
            {loading?'...':(mode==='login'?'Sign In â†’':'Create Account â†’')}
          </button>

          <div style={{textAlign:'center',marginTop:'1rem',fontSize:'0.82rem',color:'var(--dim)'}}>
            {mode==='login'?'New here?':'Already have an account?'}{' '}
            <span style={{color:'var(--gold)',cursor:'pointer',fontWeight:600}} onClick={()=>setMode(m=>m==='login'?'signup':'login')}>
              {mode==='login'?'Create account':'Sign in'}
            </span>
          </div>
        </div>
      </div>
    </div>
  );
}

// â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NAV_ITEMS = [
  { id:'home', icon:'ğŸ ', label:'Home' },
  { id:'library', icon:'ğŸ“š', label:'Study Library' },
  { id:'vault', icon:'ğŸ“', label:'Document Vault' },
  { id:'tracker', icon:'ğŸ“', label:'College Tracker' },
  { id:'achievements', icon:'â­', label:'Achievements' },
  { id:'financial', icon:'ğŸ’°', label:'Financial Aid' },
  { id:'gpa', icon:'ğŸ“Š', label:'GPA Tracker' },
  { id:'coach', icon:'ğŸ¤–', label:'Coach', special:true },
];

function Sidebar({ page, onNav, user, onSignOut, open }) {
  return (
    <div className={`sidebar${open?' open':''}`}>
      <div className="sidebar-logo">
        <div className="monogram">SM</div>
        <div className="app-name">SloanMelia</div>
        <div className="app-sub">College Command Center</div>
      </div>
      <nav className="sidebar-nav">
        {NAV_ITEMS.map(item => (
          <div key={item.id} className={`nav-item${page===item.id?' active':''}${item.special?' coach-nav':''}`} onClick={()=>onNav(item.id)}>
            <span className="nav-icon">{item.icon}</span>
            <span className="nav-label">{item.label}</span>
          </div>
        ))}
      </nav>
      <div className="sidebar-footer">
        <a
          href="https://sloanmelia.com"
          target="_blank"
          rel="noopener noreferrer"
          style={{
            display:'flex',alignItems:'center',gap:'0.5rem',
            padding:'0.5rem 0.6rem',marginBottom:'0.5rem',
            background:'rgba(200,146,42,0.12)',
            border:'1px solid rgba(200,146,42,0.3)',
            borderRadius:'6px',textDecoration:'none',
            color:'var(--gold)',fontSize:'0.78rem',fontWeight:600,
            transition:'background 0.15s'
          }}
          onMouseEnter={e=>e.currentTarget.style.background='rgba(200,146,42,0.22)'}
          onMouseLeave={e=>e.currentTarget.style.background='rgba(200,146,42,0.12)'}
        >
          <span>ğŸŒ</span>
          <span>View Public Profile</span>
          <span style={{marginLeft:'auto',opacity:0.6}}>â†—</span>
        </a>
        <div className="sidebar-user">{user?.email}</div>
        <button className="btn btn-ghost w100" style={{color:'rgba(255,255,255,0.35)',textAlign:'left',paddingLeft:0}} onClick={onSignOut}>Sign Out</button>
      </div>
    </div>
  );
}

// â”€â”€ HOME MODULE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â”€â”€ GPA SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GRADE_POINTS = {
  'A+':4.0,'A':4.0,'A-':3.7,
  'B+':3.3,'B':3.0,'B-':2.7,
  'C+':2.3,'C':2.0,'C-':1.7,
  'D+':1.3,'D':1.0,'D-':0.7,
  'F':0.0,'WF':0.0,'P':null,'W':null,'I':null
};
function gradeToPoints(letter) {
  if(!letter) return null;
  return GRADE_POINTS[letter.trim().toUpperCase()] ?? null;
}
function calcGPA(grades) {
  const eligible = grades.filter(g => g.grade_points !== null && g.credit_hours > 0);
  if(!eligible.length) return null;
  const totalPts = eligible.reduce((s,g)=>s + (g.grade_points * g.credit_hours), 0);
  const totalCr  = eligible.reduce((s,g)=>s + g.credit_hours, 0);
  return totalCr > 0 ? Math.round((totalPts/totalCr)*1000)/1000 : null;
}

function HomeModule({ onNav, user }) {
  const [stats, setStats] = useState({docs:0, schools:0, achievements:0, gpa:null, totalCourses:0});
  const graduation = new Date('2026-05-15');
  const days = Math.max(0, Math.ceil((graduation - new Date())/(1000*60*60*24)));

  const loadStats = () => {
    const sb = getSupabase();
    const uid = user?.id;
    if(!uid) return;
    Promise.all([
      sb.from('documents').select('id',{count:'exact'}).eq('user_id',uid),
      sb.from('college_applications').select('id',{count:'exact'}).eq('user_id',uid),
      sb.from('achievements').select('id',{count:'exact'}).eq('user_id',uid),
      sb.from('grades').select('grade_points,credit_hours').eq('user_id',uid),
    ]).then(([d,c,a,g])=>{
      const gpa = calcGPA(g.data||[]);
      setStats({docs:d.count||0, schools:c.count||0, achievements:a.count||0,
                gpa, totalCourses:(g.data||[]).length});
    }).catch(()=>{});
  };

  useEffect(()=>{ loadStats(); },[user]);

  const gpaColor = stats.gpa === null ? 'var(--dim)'
    : stats.gpa >= 3.7 ? '#059669'
    : stats.gpa >= 3.3 ? '#d97706'
    : '#dc2626';

  return (
    <div>
      <div className="page-header">
        <div className="page-title serif">Welcome back, <em style={{color:'var(--gold)'}}>Sloan</em> ğŸ‘‹</div>
        <div className="page-sub">Class of 2026 Â· Alton High School Â· Future Dr. Smith</div>
      </div>
      <div className="page-content">

        {/* Stats row â€” GPA is now live from DB */}
        <div className="stats-row">
          <div className="stat-card" style={{borderTopColor: gpaColor}}>
            <span className="stat-num" style={{color: gpaColor}}>
              {stats.gpa !== null ? stats.gpa.toFixed(3) : '3.840'}
            </span>
            <span className="stat-lbl">
              Cumulative GPA
              {stats.totalCourses > 0 && <span style={{display:'block',fontSize:'0.7rem',color:'var(--dim)'}}>{stats.totalCourses} courses tracked</span>}
            </span>
          </div>
          <div className="stat-card"><span className="stat-num">{stats.docs}</span><span className="stat-lbl">Documents Uploaded</span></div>
          <div className="stat-card"><span className="stat-num">{stats.schools}</span><span className="stat-lbl">Schools Tracked</span></div>
          <div className="stat-card" style={{borderTopColor:'var(--gold)'}}><span className="stat-num">{days}</span><span className="stat-lbl">Days to Graduation</span></div>
        </div>

        <div className="section-label">Quick Actions</div>
        <div className="grid3" style={{marginBottom:'1.5rem'}}>
          {[
            {icon:'ğŸ“Š',title:'Update GPA',desc:'Add courses or upload transcript to recalculate',action:'gpa',color:'#059669'},
            {icon:'ğŸ¤–',title:'Ask Your Coach',desc:'Get help with forms, essays, and applications',action:'coach',color:'var(--gold)'},
            {icon:'ğŸ“',title:'Upload Document',desc:'Add transcripts, recommendation letters, and more',action:'vault',color:'var(--teal)'},
          ].map(a=>(
            <div key={a.action} className="card" style={{borderTop:`3px solid ${a.color}`,cursor:'pointer'}} onClick={()=>onNav(a.action)}>
              <div style={{fontSize:'1.5rem',marginBottom:'0.5rem'}}>{a.icon}</div>
              <div className="card-title" style={{fontSize:'0.97rem'}}>{a.title}</div>
              <div style={{fontSize:'0.82rem',color:'var(--dim)',marginTop:'0.3rem'}}>{a.desc}</div>
            </div>
          ))}
        </div>

        <div className="card" style={{borderTop:'3px solid var(--gold)',marginBottom:'1rem',display:'flex',alignItems:'center',justifyContent:'space-between',padding:'1rem 1.2rem'}}>
          <div>
            <div style={{fontWeight:700,fontSize:'0.95rem',marginBottom:'0.2rem'}}>ğŸŒ Your Public Profile</div>
            <div style={{fontSize:'0.82rem',color:'var(--dim)'}}>sloanmelia.com â€” what colleges and recruiters see</div>
          </div>
          <a href="https://sloanmelia.com" target="_blank" rel="noopener noreferrer"
            className="btn btn-gold"
            style={{textDecoration:'none',whiteSpace:'nowrap',flexShrink:0,marginLeft:'1rem'}}>
            View Profile â†—
          </a>
        </div>

        <div className="info-box">
          <strong>Your Path to Dr. Smith</strong>
          Senior Year (now) â†’ Bachelor's in Psychology (2026â€“2030) â†’ Master's Degree (2030â€“2032) â†’ PhD in Forensic Psychology (2032â€“2036) â†’ Licensed Forensic Psychologist
        </div>
      </div>
    </div>
  );
}


// â”€â”€ STUDY LIBRARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STUDY_TOPICS â€” see plain script above


function LibraryModule({ onNav }) {
  const [search, setSearch] = useState('');
  const [yearFilter, setYearFilter] = useState('All');
  const [selected, setSelected] = useState(null);

  const filtered = STUDY_TOPICS.filter(t => {
    const matchSearch = !search || t.title.toLowerCase().includes(search.toLowerCase()) || t.desc.toLowerCase().includes(search.toLowerCase()) || t.src.toLowerCase().includes(search.toLowerCase());
    const matchYear = yearFilter === 'All' || t.year === yearFilter;
    return matchSearch && matchYear;
  });

  const counts = {};
  YEARS.forEach(y => { counts[y] = y === 'All' ? STUDY_TOPICS.length : STUDY_TOPICS.filter(t=>t.year===y).length; });

  const srcInfo = t => SRC[t.src] || SRC.Poster;

  return (
    <div>
      <div className="page-header">
        <div className="page-title serif">Academic <em style={{color:'var(--gold)'}}>Library</em> ğŸ“š</div>
        <div className="page-sub">{STUDY_TOPICS.length} free resources Â· Freshman â†’ Doctorate Â· Every textbook, every tool, 100% free</div>
      </div>
      <div className="page-content">

        {/* Search */}
        <div style={{marginBottom:'1rem'}}>
          <input className="input" placeholder="Search any topic, course, or resource..." value={search} onChange={e=>setSearch(e.target.value)}/>
        </div>

        {/* Year Filter Tabs â€” scrollable */}
        <div style={{display:'flex',gap:'0.4rem',flexWrap:'wrap',marginBottom:'1.2rem'}}>
          {YEARS.map(y=>(
            <button key={y} onClick={()=>setYearFilter(y)} style={{fontFamily:'DM Mono,monospace',fontSize:'0.55rem',letterSpacing:'0.1em',textTransform:'uppercase',padding:'0.35rem 0.8rem',border:`1px solid ${yearFilter===y?YEAR_COLOR[y]||'var(--ink)':'var(--faint)'}`,background:yearFilter===y?'var(--ink)':'transparent',color:yearFilter===y?'#fff':'var(--dim)',cursor:'pointer',transition:'all 0.15s'}}>
              {y} <span style={{opacity:0.6}}>({counts[y]||STUDY_TOPICS.length})</span>
            </button>
          ))}
        </div>

        {/* Stats bar */}
        {yearFilter !== 'All' && (
          <div className="info-box" style={{marginBottom:'1rem',padding:'0.7rem 1rem'}}>
            <strong style={{color:YEAR_COLOR[yearFilter]||'var(--gold)'}}>{yearFilter}</strong>
            {yearFilter==='ğŸ“Œ Reference Posters' && ' â€” SloanMelia built-in forensic psychology reference cards. Click Study â†’ to explore key concepts.'}
            {yearFilter==='ğŸŒ± Freshman' && ' â€” Wide roots. General education foundation. Every textbook is free via OpenStax or LibreTexts.'}
            {yearFilter==='ğŸŒ¿ Sophomore' && ' â€” The trunk thickens. Core psychology courses required at every program in the country.'}
            {yearFilter==='ğŸŒ³ Junior' && ' â€” The path narrows toward forensics. Upper-division specialization begins.'}
            {yearFilter==='ğŸ“ Senior' && ' â€” Pre-graduate preparation. Clinical assessment, ethics, and research design.'}
            {yearFilter==="ğŸ”¬ Master's" && " â€” Graduate specialization. Forensic assessment, risk instruments, mental health law, and expert testimony."}
            {yearFilter==='ğŸ›ï¸ Doctoral' && ' â€” Research and dissertation level. The living edge of the field. Original contribution to knowledge.'}
            {yearFilter==='âš¡ Research Tools' && ' â€” Free platforms and tools that separate a good student from a future pioneer. Set these up now, use them for life.'}
          </div>
        )}

        {/* Results count */}
        <div style={{fontFamily:'DM Mono,monospace',fontSize:'0.6rem',letterSpacing:'0.1em',color:'var(--dim)',marginBottom:'0.8rem',textTransform:'uppercase'}}>
          {filtered.length} resource{filtered.length!==1?'s':''} {search?`matching "${search}"`:''}
        </div>

        {/* Cards grid */}
        {filtered.length === 0 ? (
          <div className="empty-state">
            <div className="empty-icon">ğŸ”</div>
            <div className="empty-text">No resources match your search</div>
            <button className="btn btn-ghost" onClick={()=>{setSearch('');setYearFilter('All');}}>Clear filters</button>
          </div>
        ) : (
          <div className="grid3">
            {filtered.map(t => {
              const si = srcInfo(t);
              return (
                <div key={t.id} className="card" style={{borderTop:`3px solid ${YEAR_COLOR[t.year]||'var(--ink)'}`,cursor:'pointer',display:'flex',flexDirection:'column'}} onClick={()=>setSelected(t)}>
                  <div style={{display:'flex',gap:'0.4rem',flexWrap:'wrap',marginBottom:'0.5rem'}}>
                    <span className={`badge ${YEAR_BADGE[t.year]||'badge-gray'}`} style={{fontSize:'0.48rem'}}>{t.year}</span>
                    <span className={`badge ${si.badge}`} style={{fontSize:'0.48rem'}}>{si.label}</span>
                  </div>
                  <div className="card-title" style={{fontSize:'0.92rem',marginBottom:'0.25rem'}}>{t.title}</div>
                  <div style={{fontSize:'0.79rem',color:'var(--dim)',lineHeight:1.5,flex:1}}>{t.desc}</div>
                  <div style={{display:'flex',gap:'0.4rem',marginTop:'0.8rem',flexWrap:'wrap'}}>
                    <button className="btn btn-ghost btn-sm" style={{paddingLeft:0,fontSize:'0.55rem'}} onClick={e=>{e.stopPropagation();setSelected(t);}}>Study â†’</button>
                    {t.url && <button className="btn btn-outline btn-sm" style={{fontSize:'0.55rem'}} onClick={e=>{e.stopPropagation();window.open(t.url,'_blank');}}>Open Free â†—</button>}
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>

      {/* Detail Modal */}
      <Modal open={!!selected} onClose={()=>setSelected(null)} title={selected?.title} wide>
        {selected && (()=>{
          const si = srcInfo(selected);
          return (
            <>
              <div style={{display:'flex',gap:'0.5rem',flexWrap:'wrap',marginBottom:'1rem'}}>
                <span className={`badge ${YEAR_BADGE[selected.year]||'badge-gray'}`}>{selected.year}</span>
                <span className={`badge ${si.badge}`}>{si.label}</span>
              </div>
              <p style={{fontSize:'0.9rem',color:'var(--dim)',marginBottom:'1.2rem',lineHeight:1.65}}>{selected.desc}</p>
              <div className="section-label">Key Concepts</div>
              <ul style={{paddingLeft:'1.2rem',marginBottom:'1.5rem'}}>
                {selected.concepts.map((c,i)=><li key={i} style={{marginBottom:'0.4rem',fontSize:'0.88rem'}}>{c}</li>)}
              </ul>
              {selected.url && (
                <div className="info-box" style={{marginBottom:'1rem'}}>
                  <strong>Free Resource</strong>
                  <a href={selected.url} target="_blank" rel="noreferrer" style={{color:'var(--gold)',wordBreak:'break-all'}}>{selected.url}</a>
                </div>
              )}
              <div style={{display:'flex',gap:'0.5rem',flexWrap:'wrap'}}>
                {selected.url && <a href={selected.url} target="_blank" rel="noreferrer" className="btn btn-gold" style={{textDecoration:'none'}}>Open Free Resource â†—</a>}
                <button className="btn btn-primary" onClick={()=>{setSelected(null);onNav('coach');}}>ğŸ¤– Ask Coach About This</button>
              </div>
            </>
          );
        })()}
      </Modal>
    </div>
  );
}


// â”€â”€ DOCUMENT VAULT CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DOC_CATS = ['Transcript','Test Scores','Recommendation Letter','Essay','Certificate','Resume','Financial','Other'];
const CAT_BADGE = {Transcript:'badge-blue','Test Scores':'badge-teal','Recommendation Letter':'badge-gold',Essay:'badge-green',Certificate:'badge-teal',Resume:'badge-gold',Financial:'badge-red',Other:'badge-gray'};

function VaultModule({ user, toast }) {
  const [docs, setDocs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [cat, setCat] = useState('Transcript');
  const [uploading, setUploading] = useState(false);
  const fileRef = useRef();

  const load = async () => {
    const sb = getSupabase();
    const { data } = await sb.from('documents').select('*').eq('user_id', user.id).order('created_at',{ascending:false});
    setDocs(data||[]);
    setLoading(false);
  };
  useEffect(()=>{ load(); },[]);

  const upload = async (file) => {
    if(!file) return;
    if(file.size > 10*1024*1024) { toast('File must be under 10MB','error'); return; }
    setUploading(true);
    const sb = getSupabase();
    const path = `${user.id}/${Date.now()}_${file.name}`;
    const { error: se } = await sb.storage.from('documents').upload(path, file);
    if(se) { toast('Upload failed: '+se.message,'error'); setUploading(false); return; }
    const { error: de } = await sb.from('documents').insert({user_id:user.id,name:file.name,category:cat,file_path:path,file_size:file.size});
    if(de) toast('Saved to storage but DB record failed','warn');
    else toast('Document uploaded!','success');
    setUploading(false);
    load();
  };

  const del = async (doc) => {
    if(!window.confirm('Delete '+doc.name+'?')) return;
    const sb = getSupabase();
    await sb.storage.from('documents').remove([doc.file_path]);
    await sb.from('documents').delete().eq('id',doc.id);
    toast('Document deleted','success');
    load();
  };

  const fmtSize = (bytes) => {
    if(!bytes) return '';
    if(bytes<1024) return bytes+'B';
    if(bytes<1024*1024) return (bytes/1024).toFixed(0)+'KB';
    return (bytes/(1024*1024)).toFixed(1)+'MB';
  };

  return (
    <div>
      <div className="page-header">
        <div className="page-title serif">Document <em style={{color:'var(--gold)'}}>Vault</em></div>
        <div className="page-sub">Securely store all your application documents</div>
      </div>
      <div className="page-content">

        <div className="card" style={{borderTop:'3px solid var(--gold)',marginBottom:'1.5rem'}}>
          <div className="section-label">Upload New Document</div>
          <div style={{marginBottom:'0.8rem'}}>
            <label className="label">Category</label>
            <select className="select" value={cat} onChange={e=>setCat(e.target.value)}>
              {DOC_CATS.map(c=><option key={c}>{c}</option>)}
            </select>
          </div>

          <div
            style={{border:'2px dashed var(--faint)',padding:'2rem',textAlign:'center',cursor:'pointer',background:'var(--bg)'}}
            onClick={()=>fileRef.current.click()}
            onDragOver={e=>{e.preventDefault();e.currentTarget.style.borderColor='var(--gold)';}}
            onDragLeave={e=>{e.currentTarget.style.borderColor='var(--faint)';}}
            onDrop={e=>{e.preventDefault();e.currentTarget.style.borderColor='var(--faint)';upload(e.dataTransfer.files[0]);}}
          >
            <div style={{fontSize:'2rem',marginBottom:'0.5rem'}}>ğŸ“</div>
            <div style={{fontSize:'0.88rem',color:'var(--dim)'}}>Drag & drop or <span style={{color:'var(--gold)',fontWeight:600}}>click to browse</span></div>
            <div style={{fontSize:'0.75rem',color:'var(--dim)',marginTop:'0.3rem'}}>Max 10MB Â· PDF, DOC, JPG, PNG</div>
            {uploading && <div style={{marginTop:'0.5rem',color:'var(--gold)',fontFamily:'DM Mono,monospace',fontSize:'0.65rem',letterSpacing:'0.1em'}}>UPLOADING...</div>}
          </div>
          <input ref={fileRef} type="file" style={{display:'none'}} onChange={e=>upload(e.target.files[0])}/>
        </div>

        {loading ? <div className="empty-state"><div className="typing"><span/><span/><span/></div></div> :
          docs.length===0 ? (
            <div className="empty-state">
              <div className="empty-icon">ğŸ“</div>
              <div className="empty-text">No documents yet</div>
              <div style={{fontSize:'0.82rem',color:'var(--dim)'}}>Upload your transcript, recommendation letters, and resume above</div>
            </div>
          ) : (
            <div>
              <div className="section-label">{docs.length} Document{docs.length!==1?'s':''} Stored</div>
              {docs.map(doc=>(
                <div key={doc.id} className="card" style={{display:'flex',alignItems:'center',justifyContent:'space-between',marginBottom:'0.5rem',padding:'0.8rem 1.2rem'}}>
                  <div style={{display:'flex',alignItems:'center',gap:'0.8rem'}}>
                    <span style={{fontSize:'1.2rem'}}>ğŸ“„</span>
                    <div>
                      <div style={{fontWeight:600,fontSize:'0.9rem'}}>{doc.name}</div>
                      <div style={{display:'flex',gap:'0.5rem',marginTop:'0.2rem',alignItems:'center'}}>
                        <span className={`badge ${CAT_BADGE[doc.category]||'badge-gray'}`}>{doc.category}</span>
                        <span style={{fontSize:'0.75rem',color:'var(--dim)'}}>{fmtSize(doc.file_size)} Â· {new Date(doc.created_at).toLocaleDateString()}</span>
                      </div>
                    </div>
                  </div>
                  <button className="btn btn-danger btn-sm" onClick={()=>del(doc)}>Delete</button>
                </div>
              ))}
            </div>
          )
        }
      </div>
    </div>
  );
}

// â”€â”€ COLLEGE TRACKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SEED_SCHOOLS = [
  {school_name:'Southern Illinois University Edwardsville (SIUE)',portal_url:'https://www.siue.edu',status:'researching',notes:'Strong psychology program near home'},
  {school_name:'University of Illinois Springfield',portal_url:'https://www.uis.edu',status:'researching',notes:'Good forensic science resources'},
  {school_name:'Missouri Baptist University',portal_url:'https://www.mobap.edu',status:'researching',notes:'Christian university, smaller class sizes'},
  {school_name:'Saint Louis University',portal_url:'https://www.slu.edu',status:'researching',notes:'Strong clinical psych program'},
];

const STATUS_COLORS = {researching:'badge-gray','in-progress':'badge-gold',submitted:'badge-blue',accepted:'badge-green',waitlisted:'badge-teal',rejected:'badge-red'};
const STATUS_LABELS = {researching:'Researching','in-progress':'In Progress',submitted:'Submitted',accepted:'Accepted',waitlisted:'Waitlisted',rejected:'Rejected'};

function TrackerModule({ user, toast }) {
  const [schools, setSchools] = useState([]);
  const [loading, setLoading] = useState(true);
  const [showAdd, setShowAdd] = useState(false);
  const [form, setForm] = useState({school_name:'',deadline:'',portal_url:'',status:'researching',notes:''});

  const load = async () => {
    const sb = getSupabase();
    const { data } = await sb.from('college_applications').select('*').eq('user_id',user.id).order('deadline',{ascending:true,nullsFirst:false});
    if(data&&data.length===0) {
      const seeded = await Promise.all(SEED_SCHOOLS.map(s => sb.from('college_applications').insert({...s,user_id:user.id}).select().single()));
      setSchools(seeded.map(r=>r.data).filter(Boolean));
    } else setSchools(data||[]);
    setLoading(false);
  };
  useEffect(()=>{ load(); },[]);

  const add = async () => {
    if(!form.school_name) return;
    const sb = getSupabase();
    const { error } = await sb.from('college_applications').insert({...form, user_id:user.id});
    if(error) toast('Could not add school','error');
    else { toast('School added!'); setShowAdd(false); setForm({school_name:'',deadline:'',portal_url:'',status:'researching',notes:''}); load(); }
  };

  const updateStatus = async (id, status) => {
    const sb = getSupabase();
    await sb.from('college_applications').update({status}).eq('id',id);
    setSchools(prev=>prev.map(s=>s.id===id?{...s,status}:s));
  };

  return (
    <div>
      <div className="page-header" style={{display:'flex',justifyContent:'space-between',alignItems:'flex-end',flexWrap:'wrap',gap:'1rem'}}>
        <div>
          <div className="page-title serif">College <em style={{color:'var(--gold)'}}>Tracker</em></div>
          <div className="page-sub">Track deadlines, statuses, and requirements</div>
        </div>
        <button className="btn btn-gold" onClick={()=>setShowAdd(true)}>+ Add School</button>
      </div>
      <div className="page-content">
        {loading ? <div className="empty-state"><div className="typing"><span/><span/><span/></div></div> :
          schools.map(s=>{
            const daysLeft = s.deadline ? daysUntil(s.deadline) : null;
            return (
              <div key={s.id} className="card" style={{marginBottom:'1rem',borderLeft:`4px solid ${s.status==='accepted'?'var(--green)':s.status==='rejected'?'var(--red)':'var(--ink)'}`}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',flexWrap:'wrap',gap:'0.5rem'}}>
                  <div>
                    <div className="card-title" style={{fontSize:'1.05rem'}}>{s.school_name}</div>
                    <div style={{display:'flex',gap:'0.5rem',marginTop:'0.4rem',flexWrap:'wrap',alignItems:'center'}}>
                      <span className={`badge ${STATUS_COLORS[s.status]||'badge-gray'}`}>{STATUS_LABELS[s.status]||s.status}</span>
                      {daysLeft!==null && <span style={{fontSize:'0.78rem',color:daysLeft<14?'var(--red)':'var(--dim)',fontFamily:'DM Mono,monospace'}}>{daysLeft>0?`${daysLeft} days remaining`:'Past deadline'}</span>}
                      {s.portal_url && <a href={s.portal_url} target="_blank" rel="noreferrer" style={{fontSize:'0.75rem',color:'var(--gold)'}}>Portal â†’</a>}
                    </div>
                  </div>
                  <select className="select" style={{width:'auto',fontSize:'0.78rem'}} value={s.status} onChange={e=>updateStatus(s.id,e.target.value)}>
                    {Object.entries(STATUS_LABELS).map(([v,l])=><option key={v} value={v}>{l}</option>)}
                  </select>
                </div>
                {s.notes && <div style={{marginTop:'0.6rem',fontSize:'0.83rem',color:'var(--dim)',fontStyle:'italic'}}>{s.notes}</div>}
                <div style={{marginTop:'0.8rem',display:'flex',gap:'0.4rem',flexWrap:'wrap'}}>
                  {['Transcript','Rec Letters','Personal Essay','App Fee','Test Scores'].map(item=>(
                    <span key={item} style={{fontSize:'0.72rem',padding:'0.2rem 0.6rem',border:'1px solid var(--faint)',color:'var(--dim)',fontFamily:'DM Mono,monospace'}}>â˜ {item}</span>
                  ))}
                </div>
              </div>
            );
          })
        }
      </div>

      <Modal open={showAdd} onClose={()=>setShowAdd(false)} title="Add College">
        <div className="mb2"><label className="label">School Name *</label><input className="input" value={form.school_name} onChange={e=>setForm(p=>({...p,school_name:e.target.value}))} placeholder="University name"/></div>
        <div className="mb2"><label className="label">Application Deadline</label><input className="input" type="date" value={form.deadline} onChange={e=>setForm(p=>({...p,deadline:e.target.value}))}/></div>
        <div className="mb2"><label className="label">Portal URL</label><input className="input" value={form.portal_url} onChange={e=>setForm(p=>({...p,portal_url:e.target.value}))} placeholder="https://..."/></div>
        <div className="mb2"><label className="label">Notes</label><textarea className="input" value={form.notes} onChange={e=>setForm(p=>({...p,notes:e.target.value}))} placeholder="Any notes about this school..."/></div>
        <button className="btn btn-gold" onClick={add}>Add School</button>
      </Modal>
    </div>
  );
}

// â”€â”€ ACHIEVEMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SEED_ACHIEVEMENTS = [
  {title:'Patient Enrichment Program',category:'volunteer',role:'Founder & Program Director',description:'Self-designed annual program collecting enrichment items (games, puzzles, books, art supplies) for hospital patients experiencing mental health crises or cognitive decline. Unaffiliated with any hospital â€” community-funded and personally championed. Extended from August to September due to community response. Now an ongoing annual program.',impact:'Ongoing annual program serving multiple local hospitals'},
  {title:'Mu Alpha Theta',category:'organization',role:'Member',description:'National mathematics honor society for high school students. Membership reflects demonstrated excellence in mathematics coursework and academic achievement.',impact:'National academic recognition in mathematics'},
  {title:'Link Crew',category:'organization',role:'Peer Mentor',description:'Selected and trained peer mentorship program. Link Crew members guide incoming freshmen through the high school transition â€” providing orientation, support, and connection throughout their first year.',impact:'Direct mentorship for incoming students'},
  {title:'Salvation Army Meal Service',category:'volunteer',role:'Volunteer',description:'Regular volunteer service preparing and serving meals to community members in need at the Salvation Army. Consistent direct community engagement.',impact:'Consistent direct community service'},
  {title:'Church Nursery',category:'volunteer',role:'Volunteer Caregiver',description:'Consistent volunteer childcare and engagement service in faith community nursery. Reliable presence providing care and support.',impact:'Reliable caregiving for faith community'},
  {title:'Mathematics Tutoring',category:'volunteer',role:'Peer Tutor',description:'Volunteer mathematics tutoring for students needing additional academic support. Translating complex concepts into accessible explanations with patience.',impact:'Peer academic support in mathematics'},
];
const ACH_BADGE = {volunteer:'badge-green',organization:'badge-blue',internship:'badge-purple',award:'badge-gold',other:'badge-gray'};

function AchievementsModule({ user, toast, coachUrl }) {
  const [items, setItems] = useState([]);
  const [loading, setLoading] = useState(true);
  const [showAdd, setShowAdd] = useState(false);
  const [genResult, setGenResult] = useState('');
  const [genLoading, setGenLoading] = useState(false);
  const [form, setForm] = useState({title:'',category:'volunteer',role:'',description:'',impact:''});

  const load = async () => {
    const sb = getSupabase();
    const { data } = await sb.from('achievements').select('*').eq('user_id',user.id).order('created_at');
    if(data&&data.length===0) {
      await Promise.all(SEED_ACHIEVEMENTS.map(a=>sb.from('achievements').insert({...a,user_id:user.id})));
      const { data:d2 } = await sb.from('achievements').select('*').eq('user_id',user.id).order('created_at');
      setItems(d2||[]);
    } else setItems(data||[]);
    setLoading(false);
  };
  useEffect(()=>{ load(); },[]);

  const add = async () => {
    if(!form.title) return;
    const sb = getSupabase();
    await sb.from('achievements').insert({...form, user_id:user.id});
    toast('Achievement added!'); setShowAdd(false); setForm({title:'',category:'volunteer',role:'',description:'',impact:''});
    load();
  };

  const del = async (id) => {
    if(!window.confirm('Delete this achievement?')) return;
    const sb = getSupabase();
    await sb.from('achievements').delete().eq('id',id);
    toast('Deleted','success'); load();
  };

  const generate = async () => {
    if(!coachUrl) { toast('Coach URL not configured. Add it in setup.','warn'); return; }
    setGenLoading(true);
    const achText = items.map(a=>`${a.title} | ${a.role} | ${a.description}`).join('\n');
    try {
      const res = await fetch(coachUrl, {
        method:'POST',
        headers:{'Content-Type':'application/json','Authorization':'Bearer '+getAnonKey()},
        body: JSON.stringify({
          messages:[{role:'user',content:`Format Sloan's activities for the Common App Activities section. Max 10 activities, 150 characters each for description, include position/role and organization. Here are her activities:\n\n${achText}\n\nFormat each as:\nACTIVITY [#]: [Title]\nPosition: [Role]\nOrganization: [Org name]\nDescription (150 chars max): [description]\n\nCount characters carefully.`}],
          vaultContext: achText
        })
      });
      const data = await res.json();
      const text = data.content?.[0]?.text || 'No response from Coach.';
      setGenResult(text);
    } catch(e) { toast('Coach connection failed','error'); }
    setGenLoading(false);
  };

  return (
    <div>
      <div className="page-header" style={{display:'flex',justifyContent:'space-between',alignItems:'flex-end',flexWrap:'wrap',gap:'1rem'}}>
        <div>
          <div className="page-title serif"><em style={{color:'var(--gold)'}}>Achievements</em> Log</div>
          <div className="page-sub">Your extracurriculars, service, and leadership</div>
        </div>
        <div style={{display:'flex',gap:'0.5rem',flexWrap:'wrap'}}>
          <button className="btn btn-outline btn-sm" onClick={generate} disabled={genLoading}>{genLoading?'Generating...':'ğŸ¤– Generate Common App Activities'}</button>
          <button className="btn btn-gold btn-sm" onClick={()=>setShowAdd(true)}>+ Add Achievement</button>
        </div>
      </div>
      <div className="page-content">
        {genResult && (
          <div style={{background:'var(--ink)',color:'#e0d8d0',padding:'1.5rem',marginBottom:'1.5rem'}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'0.8rem'}}>
              <div className="mono" style={{fontSize:'0.6rem',letterSpacing:'0.15em',textTransform:'uppercase',color:'var(--gold)'}}>Common App Activities â€” Coach Output</div>
              <button className="btn btn-gold btn-sm" onClick={()=>{navigator.clipboard.writeText(genResult);toast('Copied!','success');}}>Copy All</button>
            </div>
            <pre style={{whiteSpace:'pre-wrap',fontFamily:'DM Mono,monospace',fontSize:'0.78rem',lineHeight:1.7}}>{genResult}</pre>
          </div>
        )}

        {loading ? <div className="empty-state"><div className="typing"><span/><span/><span/></div></div> :
          items.map(a=>(
            <div key={a.id} className="card" style={{marginBottom:'1rem',borderTop:'3px solid var(--ink)'}}>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start'}}>
                <div style={{flex:1}}>
                  <div style={{display:'flex',gap:'0.5rem',alignItems:'center',flexWrap:'wrap',marginBottom:'0.3rem'}}>
                    <span className={`badge ${ACH_BADGE[a.category]||'badge-gray'}`}>{a.category}</span>
                    {a.role && <span style={{fontFamily:'DM Mono,monospace',fontSize:'0.58rem',letterSpacing:'0.1em',textTransform:'uppercase',color:'var(--gold)'}}>{a.role}</span>}
                  </div>
                  <div className="card-title">{a.title}</div>
                  <p style={{fontSize:'0.85rem',color:'#3a3020',marginTop:'0.4rem',lineHeight:1.65}}>{a.description}</p>
                  {a.impact && <div style={{fontSize:'0.82rem',color:'var(--dim)',fontStyle:'italic',marginTop:'0.4rem'}}>Impact: {a.impact}</div>}
                </div>
                <button className="btn btn-danger btn-sm" style={{marginLeft:'1rem',flexShrink:0}} onClick={()=>del(a.id)}>Delete</button>
              </div>
            </div>
          ))
        }
      </div>

      <Modal open={showAdd} onClose={()=>setShowAdd(false)} title="Add Achievement">
        <div className="mb2"><label className="label">Title *</label><input className="input" value={form.title} onChange={e=>setForm(p=>({...p,title:e.target.value}))} placeholder="Name of organization, award, or activity"/></div>
        <div className="mb2"><label className="label">Category</label>
          <select className="select" value={form.category} onChange={e=>setForm(p=>({...p,category:e.target.value}))}>
            {['volunteer','organization','internship','award','other'].map(c=><option key={c}>{c}</option>)}
          </select>
        </div>
        <div className="mb2"><label className="label">Your Role / Position</label><input className="input" value={form.role} onChange={e=>setForm(p=>({...p,role:e.target.value}))} placeholder="President, Volunteer, Member..."/></div>
        <div className="mb2"><label className="label">Description</label><textarea className="input" value={form.description} onChange={e=>setForm(p=>({...p,description:e.target.value}))} placeholder="What did you do? What did it involve?"/></div>
        <div className="mb2"><label className="label">One-Line Impact</label><input className="input" value={form.impact} onChange={e=>setForm(p=>({...p,impact:e.target.value}))} placeholder="What did your involvement accomplish?"/></div>
        <button className="btn btn-gold" onClick={add}>Save Achievement</button>
      </Modal>
    </div>
  );
}

// â”€â”€ FINANCIAL AID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SCHOLARSHIPS_SEED = [
  {name:'Illinois MAP Grant',amount_min:0,amount_max:5968,status:'researching',url:'https://www.isac.org',requirements:'Illinois resident, financial need, FAFSA required by state deadline'},
  {name:'APA Psychology Undergraduate Scholarship',amount_min:1000,amount_max:1000,status:'researching',url:'https://www.apa.org',requirements:'Psychology major, sophomore+ standing (apply after starting college)'},
  {name:'American Psychology-Law Society',amount_min:500,amount_max:2000,status:'researching',url:'https://www.apadivisions.org/division-41',requirements:'Interest in forensic psychology / psychology and law'},
  {name:'Jack Kent Cooke Foundation',amount_min:0,amount_max:55000,status:'researching',url:'https://www.jkcf.org',requirements:'High-achieving students with financial need'},
  {name:'Alton Community Foundation',amount_min:500,amount_max:5000,status:'researching',url:'https://www.altoncommunityfoundation.org',requirements:'Alton/Madison County IL resident'},
  {name:'Phi Kappa Phi Scholarship',amount_min:0,amount_max:8500,status:'researching',url:'https://www.phikappaphi.org',requirements:'First-year college student, chapter sponsorship'},
  {name:'Women in STEM Scholarships',amount_min:500,amount_max:5000,status:'researching',url:'https://www.fastweb.com',requirements:'Female student in STEM or social science'},
];
const FAFSA_SECTIONS = [
  {title:'Before You Start â€” What to Gather',content:<ul><li>Prior year tax returns for parents AND student</li><li>W-2 forms</li><li>Bank account balances for parents and student</li><li>Investment account balances</li><li>Social Security numbers for student and parents</li><li>FSA ID â€” create at <strong>studentaid.gov</strong> (this IS your signature, do it early)</li><li>Sloan's Alton High School student ID number</li><li>List of schools to add to FAFSA</li></ul>},
  {title:'Key FAFSA Facts',content:<ul><li>FAFSA opens <strong>October 1</strong> each year for the following academic year</li><li>Illinois priority deadline: typically <strong>late January</strong> â€” check isac.org each year</li><li>The new <strong>Student Aid Index (SAI)</strong> replaced EFC starting 2024-2025</li><li>Lower SAI = more aid eligible</li><li>Most schools use FAFSA for ALL financial aid including institutional scholarships</li><li>FAFSA is FREE â€” never pay to file it</li></ul>},
  {title:'What Counts as Assets (and What Doesn\'t)',content:<ul><li>Parent assets counted at max <strong>5.64%</strong> toward SAI â€” low impact</li><li>Student assets counted at <strong>20%</strong> â€” higher impact, keep student balances low</li><li>Parent-owned <strong>529 plan: only 5.64% counts</strong> toward SAI â€” very favorable</li><li><strong>Primary home equity: does NOT count</strong> on FAFSA</li><li><strong>Retirement accounts: do NOT count</strong> on FAFSA</li><li>Small businesses (under 100 employees) owned by parents may be excluded</li></ul>},
  {title:'Illinois-Specific Aid',content:<ul><li><strong>MAP Grant</strong> (Monetary Award Program): up to $5,968/year for IL residents with financial need</li><li>Requires FAFSA completion by the Illinois state deadline â€” check isac.org for current year</li><li>MAP Grant applies to eligible Illinois colleges â€” SIUE, UIS, and SLU all have MAP-eligible programs</li><li>Award is renewable each year if you re-file FAFSA and maintain academic progress</li></ul>},
  {title:'Understanding Your Award Letter',content:<ul><li>Schools send award letters after you apply â€” may arrive at different times</li><li>Award letters may mix <strong>grants (free money)</strong>, <strong>loans (pay back)</strong>, and work-study</li><li><strong>Net price = total cost minus GRANTS ONLY</strong> â€” do not include loans in your calculation</li><li>Compare net prices across schools, not sticker prices</li><li>Contact financial aid offices to negotiate â€” it is allowed and common</li></ul>},
];

function FinancialModule({ user, toast, coachUrl }) {
  const [tab, setTab] = useState('fafsa');
  const [openSection, setOpenSection] = useState(null);
  const [scholarships, setScholarships] = useState([]);
  const [balance529, setBalance529] = useState('');
  const [targetCost, setTargetCost] = useState('');

  const loadScholarships = async () => {
    const sb = getSupabase();
    const { data } = await sb.from('scholarships').select('*').eq('user_id',user.id);
    if(data&&data.length===0) {
      await Promise.all(SCHOLARSHIPS_SEED.map(s=>sb.from('scholarships').insert({...s,user_id:user.id})));
      const { data:d2 } = await sb.from('scholarships').select('*').eq('user_id',user.id);
      setScholarships(d2||[]);
    } else setScholarships(data||[]);
  };
  useEffect(()=>{ if(tab==='scholarships') loadScholarships(); },[tab]);

  const updateScholarshipStatus = async (id, status) => {
    const sb = getSupabase();
    await sb.from('scholarships').update({status}).eq('id',id);
    setScholarships(prev=>prev.map(s=>s.id===id?{...s,status}:s));
  };

  const totalPotential = scholarships.filter(s=>s.status==='submitted'||s.status==='awarded').reduce((a,s)=>a+(s.amount_max||0),0);

  const calc529 = () => {
    const bal = parseFloat(balance529)||0;
    const annual = parseFloat(targetCost)||0;
    const years = 2026 - new Date().getFullYear();
    const projected = bal * Math.pow(1.06, years);
    const total4yr = annual * 4;
    const pct = total4yr > 0 ? Math.min(100,(projected/total4yr)*100).toFixed(0) : 0;
    return { projected: projected.toFixed(0), total4yr: total4yr.toFixed(0), pct };
  };

  return (
    <div>
      <div className="page-header">
        <div className="page-title serif">Financial <em style={{color:'var(--gold)'}}>Aid Hub</em></div>
        <div className="page-sub">FAFSA guide Â· 529 tracker Â· Scholarship database</div>
      </div>
      <div className="page-content">
        <div className="tabs">
          {[['fafsa','ğŸ“‹ FAFSA Guide'],['529','ğŸ’° 529 Tracker'],['scholarships','ğŸ† Scholarships']].map(([id,label])=>(
            <div key={id} className={`tab${tab===id?' active':''}`} onClick={()=>setTab(id)}>{label}</div>
          ))}
        </div>

        {tab==='fafsa' && (
          <div>
            <div className="info-box" style={{marginBottom:'1.5rem'}}>
              <strong>Illinois Priority Deadline</strong>
              File your FAFSA as early as possible after October 1. Illinois MAP Grant funding is limited â€” file early to maximize your award. Check <strong>isac.org</strong> for the exact current year deadline.
            </div>
            {FAFSA_SECTIONS.map((s,i)=>(
              <div key={i} className="accordion-item">
                <div className="accordion-header" onClick={()=>setOpenSection(openSection===i?null:i)}>
                  {s.title}
                  <span>{openSection===i?'â–²':'â–¼'}</span>
                </div>
                {openSection===i && <div className="accordion-body">{s.content}</div>}
              </div>
            ))}
          </div>
        )}

        {tab==='529' && (
          <div>
            <div className="info-box">
              <strong>Illinois Bright Start 529 Plan Key Facts</strong>
              State tax deduction: $10,000/yr (single) or $20,000/yr (joint filers) Â· Earnings grow tax-FREE Â· Qualified withdrawals 100% tax-free federally Â· FAFSA impact: only 5.64% counts toward SAI Â· SECURE 2.0: unused funds can roll to Roth IRA (up to $35k lifetime, account must be 15+ years old) Â· <a href="https://www.brightstartsavings.com" target="_blank" rel="noreferrer" style={{color:'var(--gold)'}}>brightstartsavings.com â†’</a>
            </div>
            <div className="grid2">
              <div>
                <label className="label">Current 529 Balance ($)</label>
                <input className="input mb2" type="number" value={balance529} onChange={e=>setBalance529(e.target.value)} placeholder="25000"/>
                <label className="label">Target School Annual Cost ($)</label>
                <input className="input" type="number" value={targetCost} onChange={e=>setTargetCost(e.target.value)} placeholder="30000"/>
              </div>
              <div className="card">
                <div className="card-label">529 Coverage Projection</div>
                {balance529 && targetCost ? (() => {
                  const {projected,total4yr,pct} = calc529();
                  return <>
                    <div style={{fontSize:'2rem',fontFamily:'Playfair Display,serif',fontWeight:900,color:'var(--gold)'}}>{pct}%</div>
                    <div style={{fontSize:'0.82rem',color:'var(--dim)',marginBottom:'0.8rem'}}>of projected 4-year costs covered</div>
                    <div className="progress-bar mb2"><div className="progress-fill" style={{width:pct+'%'}}/></div>
                    <div style={{fontSize:'0.8rem',lineHeight:1.8}}>
                      <div>Projected balance at enrollment: <strong>${parseInt(projected).toLocaleString()}</strong></div>
                      <div>4-year total cost: <strong>${parseInt(total4yr).toLocaleString()}</strong></div>
                      <div>Gap: <strong>${Math.max(0,parseInt(total4yr)-parseInt(projected)).toLocaleString()}</strong></div>
                    </div>
                  </>;
                })() : <div style={{color:'var(--dim)',fontSize:'0.85rem'}}>Enter your balance and target school cost to see projection</div>}
              </div>
            </div>
          </div>
        )}

        {tab==='scholarships' && (
          <div>
            {totalPotential > 0 && (
              <div className="card" style={{borderTop:'3px solid var(--green)',marginBottom:'1.5rem'}}>
                <div className="card-label" style={{color:'var(--green)'}}>Potential Aid Submitted</div>
                <div style={{fontSize:'2rem',fontFamily:'Playfair Display,serif',fontWeight:900,color:'var(--green)'}}>${totalPotential.toLocaleString()}</div>
                <div style={{fontSize:'0.8rem',color:'var(--dim)'}}>maximum from submitted applications</div>
              </div>
            )}
            {scholarships.map(s=>(
              <div key={s.id} className="card" style={{marginBottom:'1rem'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',flexWrap:'wrap',gap:'0.5rem'}}>
                  <div>
                    <div className="card-title">{s.name}</div>
                    <div style={{display:'flex',gap:'0.5rem',marginTop:'0.3rem',alignItems:'center',flexWrap:'wrap'}}>
                      <span className={`badge ${STATUS_COLORS[s.status]||'badge-gray'}`}>{s.status}</span>
                      <span style={{fontSize:'0.8rem',color:'var(--green)',fontWeight:600}}>{s.amount_max?`Up to $${s.amount_max.toLocaleString()}`:''}</span>
                      {s.url && <a href={s.url} target="_blank" rel="noreferrer" style={{fontSize:'0.75rem',color:'var(--gold)'}}>Info â†’</a>}
                    </div>
                    {s.requirements && <div style={{fontSize:'0.8rem',color:'var(--dim)',marginTop:'0.4rem'}}>{s.requirements}</div>}
                  </div>
                  <select className="select" style={{width:'auto',fontSize:'0.78rem'}} value={s.status} onChange={e=>updateScholarshipStatus(s.id,e.target.value)}>
                    {['researching','drafting','submitted','awarded','not-selected'].map(v=><option key={v}>{v}</option>)}
                  </select>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

// â”€â”€ COACH MODULE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â”€â”€ GPA MODULE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SEMESTERS = ['Fall 2022','Spring 2023','Fall 2023','Spring 2024','Fall 2024','Spring 2025','Fall 2025','Spring 2026'];

function GpaModule({ user, toast }) {
  const [grades, setGrades] = useState([]);
  const [loading, setLoading] = useState(true);
  const [form, setForm] = useState({course_name:'',grade_letter:'A',credit_hours:1,semester:'Fall 2025',is_ap:false,is_honors:false});
  const [saving, setSaving] = useState(false);
  const [pasteText, setPasteText] = useState('');
  const [parsing, setParsing] = useState(false);
  const [tab, setTab] = useState('view'); // 'view','add','parse'
  const coachUrl = localStorage.getItem('sm_coach')||'';
  const anonKey = localStorage.getItem('sm_key')||'';

  const load = async () => {
    setLoading(true);
    const sb = getSupabase();
    const {data} = await sb.from('grades').select('*').eq('user_id',user.id).order('grade_year',{ascending:true}).order('semester',{ascending:true});
    setGrades(data||[]);
    setLoading(false);
  };

  useEffect(()=>{ load(); },[user]);

  const gpa = calcGPA(grades);
  const byTerm = grades.reduce((acc,g)=>{
    const k = g.semester||'Unknown';
    if(!acc[k]) acc[k]=[];
    acc[k].push(g);
    return acc;
  },{});

  const addGrade = async () => {
    if(!form.course_name.trim()) { toast('Enter a course name'); return; }
    setSaving(true);
    const pts = gradeToPoints(form.grade_letter);
    const sb = getSupabase();
    const {error} = await sb.from('grades').insert({
      user_id: user.id,
      course_name: form.course_name.trim(),
      grade_letter: form.grade_letter,
      grade_points: pts,
      credit_hours: parseFloat(form.credit_hours),
      semester: form.semester,
      grade_year: parseInt(form.semester.split(' ')[1]||'2025'),
      is_ap: form.is_ap,
      is_honors: form.is_honors,
      source: 'manual'
    });
    if(error) { toast('Error saving: ' + error.message); setSaving(false); return; }
    toast('Course added!');
    setForm({course_name:'',grade_letter:'A',credit_hours:1,semester:'Fall 2025',is_ap:false,is_honors:false});
    setSaving(false);
    await load();
  };

  const deleteGrade = async (id) => {
    const sb = getSupabase();
    await sb.from('grades').delete().eq('id',id);
    await load();
    toast('Removed');
  };

  const parseTranscript = async () => {
    if(!pasteText.trim()) { toast('Paste your transcript text first'); return; }
    if(!coachUrl) { toast('Coach URL not set'); return; }
    setParsing(true);
    try {
      const prompt = `Parse this transcript and return ONLY a JSON array. Each item must have:
- course_name (string)
- grade_letter (A, A-, B+, B, B-, C+, C, etc.)
- credit_hours (number, default 1 if not shown)
- semester (e.g. "Fall 2024")
- is_ap (true/false â€” look for AP in course name)
- is_honors (true/false â€” look for H, Honors, or CP in course name)

Transcript:
${pasteText}

Return ONLY the JSON array, no other text.`;

      const res = await fetch(coachUrl, {
        method:'POST',
        headers:{'Content-Type':'application/json','Authorization':'Bearer '+anonKey},
        body: JSON.stringify({messages:[{role:'user',content:prompt}]})
      });
      const data = await res.json();
      const text = data.content?.[0]?.text || '';
      const cleaned = text.replace(/```json|```/g,'').trim();
      const parsed = JSON.parse(cleaned);

      if(!Array.isArray(parsed) || parsed.length === 0) {
        toast('Could not parse transcript â€” try adding courses manually');
        setParsing(false);
        return;
      }

      const sb = getSupabase();
      const rows = parsed.map(r=>({
        user_id: user.id,
        course_name: r.course_name,
        grade_letter: r.grade_letter,
        grade_points: gradeToPoints(r.grade_letter),
        credit_hours: parseFloat(r.credit_hours)||1,
        semester: r.semester||'Unknown',
        grade_year: parseInt((r.semester||'2025').split(' ').pop())||2025,
        is_ap: !!r.is_ap,
        is_honors: !!r.is_honors,
        source: 'parsed'
      }));

      const {error} = await sb.from('grades').insert(rows);
      if(error) { toast('Save error: '+error.message); setParsing(false); return; }
      toast(`âœ… Imported ${rows.length} courses from transcript!`);
      setPasteText('');
      setTab('view');
      await load();
    } catch(e) {
      toast('Parse failed â€” try manual entry');
    }
    setParsing(false);
  };

  const gpaColor = gpa===null?'var(--dim)':gpa>=3.7?'#059669':gpa>=3.3?'#d97706':'#dc2626';

  return (
    <div>
      <div className="page-header">
        <div className="page-title serif">GPA <em style={{color:'var(--gold)'}}>Tracker</em></div>
        <div className="page-sub">Cumulative GPA calculated from all courses Â· Updates coach and profile in real-time</div>
      </div>
      <div className="page-content">

        {/* GPA Hero */}
        <div className="card" style={{borderTop:`4px solid ${gpaColor}`,marginBottom:'1.5rem',textAlign:'center',padding:'1.5rem'}}>
          <div style={{fontSize:'3.5rem',fontWeight:900,color:gpaColor,fontFamily:'serif',lineHeight:1}}>
            {gpa !== null ? gpa.toFixed(3) : 'â€”'}
          </div>
          <div style={{fontSize:'0.85rem',color:'var(--dim)',marginTop:'0.4rem'}}>
            Cumulative GPA Â· {grades.filter(g=>g.grade_points!==null).length} courses Â· {grades.reduce((s,g)=>s+parseFloat(g.credit_hours||1),0)} credit hours
          </div>
          {grades.length === 0 && (
            <div style={{marginTop:'0.8rem',fontSize:'0.85rem',color:'var(--dim)'}}>
              Add courses manually or paste your transcript below to get started
            </div>
          )}
        </div>

        {/* Tabs */}
        <div style={{display:'flex',gap:'0.5rem',marginBottom:'1.2rem'}}>
          {[['view','ğŸ“Š View Courses'],['add','â• Add Course'],['parse','ğŸ“‹ Import Transcript']].map(([t,label])=>(
            <button key={t} onClick={()=>setTab(t)}
              className="btn btn-sm"
              style={{
                background:tab===t?'var(--ink)':'transparent',
                color:tab===t?'var(--cream)':'var(--dim)',
                border:'1px solid var(--border)',fontSize:'0.8rem'
              }}>{label}</button>
          ))}
        </div>

        {/* VIEW TAB */}
        {tab==='view' && (
          loading ? <div style={{color:'var(--dim)'}}>Loading...</div> :
          grades.length === 0 ? (
            <div className="info-box">No courses yet. Add them manually or import your transcript.</div>
          ) : (
            Object.entries(byTerm).sort().map(([semester, termGrades])=>(
              <div key={semester} style={{marginBottom:'1.5rem'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'0.5rem'}}>
                  <div className="section-label">{semester}</div>
                  <div style={{fontSize:'0.8rem',fontFamily:'monospace',color:gpaColor,fontWeight:700}}>
                    Term GPA: {calcGPA(termGrades)?.toFixed(3)||'N/A'}
                  </div>
                </div>
                {termGrades.map(g=>(
                  <div key={g.id} className="card" style={{
                    display:'flex',alignItems:'center',justifyContent:'space-between',
                    padding:'0.7rem 1rem',marginBottom:'0.4rem',
                    borderLeft:`3px solid ${
                      g.grade_points>=3.7?'#059669':g.grade_points>=2.7?'#d97706':g.grade_points!==null?'#dc2626':'var(--border)'
                    }`
                  }}>
                    <div style={{flex:1}}>
                      <div style={{fontWeight:600,fontSize:'0.9rem'}}>
                        {g.course_name}
                        {g.is_ap && <span style={{marginLeft:'0.4rem',fontSize:'0.7rem',background:'#7c3aed',color:'#fff',padding:'1px 5px',borderRadius:'3px'}}>AP</span>}
                        {g.is_honors && <span style={{marginLeft:'0.3rem',fontSize:'0.7rem',background:'#0369a1',color:'#fff',padding:'1px 5px',borderRadius:'3px'}}>H</span>}
                      </div>
                      <div style={{fontSize:'0.78rem',color:'var(--dim)'}}>{g.credit_hours} cr Â· {g.source==='parsed'?'ğŸ“‹ imported':'âœï¸ manual'}</div>
                    </div>
                    <div style={{textAlign:'right',marginRight:'1rem'}}>
                      <div style={{fontSize:'1.3rem',fontWeight:700,color:
                        g.grade_points>=3.7?'#059669':g.grade_points>=2.7?'#d97706':g.grade_points!==null?'#dc2626':'var(--dim)'
                      }}>{g.grade_letter||'N/A'}</div>
                      <div style={{fontSize:'0.75rem',color:'var(--dim)'}}>{g.grade_points!==null?g.grade_points.toFixed(1):''}</div>
                    </div>
                    <button onClick={()=>deleteGrade(g.id)} className="btn btn-sm" style={{background:'transparent',color:'var(--dim)',border:'1px solid var(--border)',fontSize:'0.75rem'}}>âœ•</button>
                  </div>
                ))}
              </div>
            ))
          )
        )}

        {/* ADD TAB */}
        {tab==='add' && (
          <div className="card" style={{padding:'1.2rem'}}>
            <div style={{display:'grid',gap:'0.8rem'}}>
              <div>
                <label className="label">Course Name</label>
                <input className="input" value={form.course_name} onChange={e=>setForm(p=>({...p,course_name:e.target.value}))} placeholder="e.g. AP Psychology"/>
              </div>
              <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:'0.6rem'}}>
                <div>
                  <label className="label">Grade</label>
                  <select className="input" value={form.grade_letter} onChange={e=>setForm(p=>({...p,grade_letter:e.target.value}))}>
                    {Object.keys(GRADE_POINTS).filter(k=>k!=='P'&&k!=='W'&&k!=='I').map(g=>(
                      <option key={g} value={g}>{g} ({GRADE_POINTS[g]?.toFixed(1)||'N/A'})</option>
                    ))}
                    <option value="P">P (Pass)</option>
                  </select>
                </div>
                <div>
                  <label className="label">Credits</label>
                  <input className="input" type="number" min="0.5" max="6" step="0.5" value={form.credit_hours} onChange={e=>setForm(p=>({...p,credit_hours:e.target.value}))}/>
                </div>
                <div>
                  <label className="label">Semester</label>
                  <select className="input" value={form.semester} onChange={e=>setForm(p=>({...p,semester:e.target.value}))}>
                    {SEMESTERS.map(s=><option key={s}>{s}</option>)}
                  </select>
                </div>
              </div>
              <div style={{display:'flex',gap:'1.5rem'}}>
                <label style={{display:'flex',alignItems:'center',gap:'0.4rem',cursor:'pointer',fontSize:'0.88rem'}}>
                  <input type="checkbox" checked={form.is_ap} onChange={e=>setForm(p=>({...p,is_ap:e.target.checked}))}/>
                  AP Course
                </label>
                <label style={{display:'flex',alignItems:'center',gap:'0.4rem',cursor:'pointer',fontSize:'0.88rem'}}>
                  <input type="checkbox" checked={form.is_honors} onChange={e=>setForm(p=>({...p,is_honors:e.target.checked}))}/>
                  Honors / CP
                </label>
              </div>
              <button className="btn btn-gold" onClick={addGrade} disabled={saving}>
                {saving ? 'Saving...' : 'â• Add Course'}
              </button>
            </div>
          </div>
        )}

        {/* PARSE TAB */}
        {tab==='parse' && (
          <div>
            <div className="info-box" style={{marginBottom:'1rem'}}>
              <strong>ğŸ“‹ Import from Transcript</strong><br/>
              Copy and paste your transcript text below. The AI Coach will automatically extract all courses, grades, and credit hours and add them to your GPA tracker.
            </div>
            <textarea
              className="input"
              style={{minHeight:'200px',resize:'vertical',fontFamily:'monospace',fontSize:'0.82rem'}}
              value={pasteText}
              onChange={e=>setPasteText(e.target.value)}
              placeholder="Paste your transcript text here...&#10;&#10;Example:&#10;Fall 2024&#10;AP Psychology  A  1.0&#10;AP Statistics  B+  1.0&#10;English 4 AP  A-  1.0"
            />
            <button className="btn btn-gold" style={{marginTop:'0.8rem',width:'100%'}} onClick={parseTranscript} disabled={parsing}>
              {parsing ? 'ğŸ¤– Parsing transcript...' : 'ğŸ¤– Import with AI Coach'}
            </button>
          </div>
        )}

      </div>
    </div>
  );
}

function CoachModule({ user, coachUrl, toast }) {
  const [tab, setTab] = useState('chat');
  const [messages, setMessages] = useState([{role:'assistant',content:"Hi Sloan! I'm your Coach. I know your full profile, GPA, courses, activities, and everything in your Document Vault. Ask me anything â€” I can fill out application forms, help with essays, explain financial aid, quiz you on forensic psychology, or tell you what documents you still need. What do you need today?"}]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const [formText, setFormText] = useState('');
  const [formResult, setFormResult] = useState('');
  const [essayPrompt, setEssayPrompt] = useState('');
  const [essayDraft, setEssayDraft] = useState('');
  const [essayResult, setEssayResult] = useState('');
  const [essayLoading, setEssayLoading] = useState(false);
  const [formLoading, setFormLoading] = useState(false);
  const [essayType, setEssayType] = useState('Common App Personal Statement (650 words)');
  const bottomRef = useRef();

  useEffect(()=>{ bottomRef.current?.scrollIntoView({behavior:'smooth'}); },[messages,loading]);

  const getVaultContext = async () => {
    const sb = getSupabase();
    const [{ data:docs },{ data:achs }] = await Promise.all([
      sb.from('documents').select('name,category').eq('user_id',user.id),
      sb.from('achievements').select('title,role,impact').eq('user_id',user.id),
    ]);
    const docStr = docs?.length ? 'Uploaded documents: ' + docs.map(d=>`${d.name} (${d.category})`).join(', ') : 'No documents uploaded yet.';
    const achStr = achs?.length ? 'Achievements: ' + achs.map(a=>`${a.title} (${a.role})`).join(', ') : '';
    // Get live GPA from grades table
    const {data:gradeData} = await sb.from('grades').select('grade_points,credit_hours,course_name,semester').eq('user_id',user.id);
    const liveGpa = calcGPA(gradeData||[]);
    const gpaStr = liveGpa !== null
      ? `Sloan's current cumulative GPA: ${liveGpa.toFixed(3)} (calculated from ${(gradeData||[]).length} courses in GPA Tracker)`
      : "Sloan's GPA: 3.84 Unweighted / 4.21 Weighted (manually recorded â€” no courses entered in GPA tracker yet)";
    const courseList = gradeData && gradeData.length > 0
      ? 'Recent courses: ' + gradeData.slice(-5).map(g=>`${g.course_name} (${g.semester}: ${g.grade_letter||'N/A'})`).join(', ')
      : '';
    return gpaStr + '\n' + docStr + (achStr ? '\n' + achStr : '') + (courseList ? '\n' + courseList : '');
  };

  const callCoach = async (msgs) => {
    if(!coachUrl) { toast('Coach URL not set. Go to Settings and add your Edge Function URL.','warn'); return null; }
    const vaultContext = await getVaultContext();
    const res = await fetch(coachUrl, {
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':'Bearer '+getAnonKey()},
      body: JSON.stringify({ messages: msgs.filter(m=>m.role!=='assistant'||msgs.indexOf(m)>0), vaultContext })
    });
    const data = await res.json();
    return data.content?.[0]?.text || 'No response.';
  };

  const sendChat = async () => {
    if(!input.trim()||loading) return;
    const userMsg = {role:'user',content:input.trim()};
    const newMsgs = [...messages, userMsg];
    setMessages(newMsgs);
    setInput('');
    setLoading(true);
    try {
      const reply = await callCoach(newMsgs);
      if(reply) setMessages(p=>[...p,{role:'assistant',content:reply}]);
    } catch(e) { toast('Coach error: '+e.message,'error'); }
    setLoading(false);
  };

  const analyzeForm = async () => {
    if(!formText.trim()) return;
    setFormLoading(true);
    try {
      const reply = await callCoach([{role:'user',content:`Analyze this college application form and generate answers for each field using Sloan's real information. Format as:\n[FIELD NAME]\nAnswer: [generated answer]\n\nForm:\n${formText}`}]);
      setFormResult(reply||'');
    } catch(e) { toast('Coach error','error'); }
    setFormLoading(false);
  };

  const getEssayHelp = async (mode) => {
    setEssayLoading(true);
    const prompt = mode==='outline'
      ? `Generate a structured essay outline for Sloan using her real background. Essay type: ${essayType}. Prompt: ${essayPrompt || '(general personal statement)'}`
      : `Review this essay draft and give specific, actionable feedback. Essay type: ${essayType}. Prompt: ${essayPrompt}.\n\nDraft:\n${essayDraft}`;
    try {
      const reply = await callCoach([{role:'user',content:prompt}]);
      setEssayResult(reply||'');
    } catch(e) { toast('Coach error','error'); }
    setEssayLoading(false);
  };

  const EDGE_FN_CODE = `import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
const ANTHROPIC_KEY = Deno.env.get('ANTHROPIC_API_KEY')
serve(async (req) => {
  const headers = { 'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'authorization, content-type',
    'Content-Type': 'application/json' }
  if (req.method === 'OPTIONS') return new Response('ok', { headers })
  const { messages, vaultContext } = await req.json()
  const systemPrompt = \`You are Sloan Smith's personal college application coach embedded in sloanmelia.com.
SLOAN'S PROFILE: Name: Sloan Smith | School: Alton High School, Alton IL | Graduating: May 2026 | GPA: 3.84 Unweighted / 4.21 Weighted | Goal: PhD in Forensic Psychology
SENIOR YEAR: AP Psychology, AP Statistics, AP English (H), Human Body Systems PLTW 2, Biomedical Internship, Sociology, Spanish 2
KEY ACTIVITY: Patient Enrichment Program â€” FOUNDER. Annual hospital donation drive. This is her CENTERPIECE story.
Others: Mu Alpha Theta (Math Honor Society), Link Crew (Peer Mentor), Salvation Army volunteer, Church nursery, Math tutoring
VAULT: \${vaultContext}
Rules: Always use her real data. Format form fields as FIELD: answer. For essays, lead with Patient Enrichment Program.\`
  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: { 'x-api-key': ANTHROPIC_KEY, 'anthropic-version': '2023-06-01', 'content-type': 'application/json' },
    body: JSON.stringify({ model: 'claude-sonnet-4-6', max_tokens: 2048, system: systemPrompt, messages })
  })
  const data = await response.json()
  return new Response(JSON.stringify(data), { headers })
})`;

  return (
    <div>
      <div className="page-header">
        <div className="page-title serif">Your AI <em style={{color:'var(--gold)'}}>Coach</em> ğŸ¤–</div>
        <div className="page-sub">Powered by Claude Â· Knows your full profile and vault</div>
      </div>
      <div className="page-content">

        {!coachUrl && (
          <div style={{background:'#faf5e0',border:'2px solid var(--gold)',padding:'1.2rem',marginBottom:'1.5rem'}}>
            <div className="mono" style={{fontSize:'0.58rem',letterSpacing:'0.15em',textTransform:'uppercase',color:'var(--gold)',marginBottom:'0.5rem'}}>âš  Coach Setup Required</div>
            <p style={{fontSize:'0.88rem',lineHeight:1.65,marginBottom:'1rem'}}>The Coach needs a Supabase Edge Function to connect to Claude. Deploy the code below to Supabase, then reload this app and enter the function URL in setup.</p>
            <div style={{marginBottom:'0.5rem'}}>
              <div style={{fontFamily:'DM Mono,monospace',fontSize:'0.55rem',letterSpacing:'0.12em',textTransform:'uppercase',color:'var(--dim)',marginBottom:'0.3rem'}}>1. Run in your terminal:</div>
              <div className="copybox">supabase functions new coach<br/>supabase functions deploy coach<br/>supabase secrets set ANTHROPIC_API_KEY=sk-ant-YOUR-KEY</div>
            </div>
            <div>
              <div style={{fontFamily:'DM Mono,monospace',fontSize:'0.55rem',letterSpacing:'0.12em',textTransform:'uppercase',color:'var(--dim)',marginBottom:'0.3rem'}}>2. Replace the function code with this:</div>
              <div className="copybox" style={{maxHeight:'200px',overflow:'auto'}}>{EDGE_FN_CODE}</div>
            </div>
            <button className="btn btn-gold btn-sm mt2" onClick={()=>{navigator.clipboard.writeText(EDGE_FN_CODE);toast('Code copied!','success');}}>Copy Edge Function Code</button>
          </div>
        )}

        <div className="tabs">
          {[['chat','ğŸ’¬ Chat'],['form','ğŸ“‹ Form Filler'],['essay','âœï¸ Essay Coach']].map(([id,label])=>(
            <div key={id} className={`tab${tab===id?' active':''}`} onClick={()=>setTab(id)}>{label}</div>
          ))}
        </div>

        {tab==='chat' && (
          <div className="chat-area">
            <div className="chat-messages">
              {messages.map((m,i)=>(
                <div key={i} className={`chat-bubble ${m.role==='user'?'user':'coach'}`}>
                  {m.content.split('\n').map((line,j)=><div key={j}>{line||'\u00a0'}</div>)}
                </div>
              ))}
              {loading && <div className="typing chat-bubble coach"><span/><span/><span/></div>}
              <div ref={bottomRef}/>
            </div>
            <div className="chat-input-row">
              <input className="chat-input" value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&sendChat()} placeholder="Ask your Coach anything..." disabled={loading}/>
              <button className="btn btn-gold" onClick={sendChat} disabled={loading||!input.trim()}>Send</button>
              <button className="btn btn-ghost" onClick={()=>setMessages([messages[0]])}>Clear</button>
            </div>
            <div style={{marginTop:'0.5rem',display:'flex',gap:'0.5rem',flexWrap:'wrap'}}>
              {['Fill my Common App activities section','What documents am I missing?','Help me write my personal statement','Explain FAFSA to me simply'].map(s=>(
                <span key={s} style={{fontSize:'0.72rem',padding:'0.25rem 0.7rem',border:'1px solid var(--faint)',cursor:'pointer',color:'var(--dim)'}} onClick={()=>{setInput(s);}}>{s}</span>
              ))}
            </div>
          </div>
        )}

        {tab==='form' && (
          <div>
            <div style={{background:'#fff8e8',border:'1px solid var(--gold)',padding:'0.8rem 1rem',marginBottom:'1rem',fontSize:'0.82rem'}}>
              âš  Review all answers before pasting. Always verify school-specific requirements and current dates.
            </div>
            <label className="label">Paste any college application form, FAFSA section, or scholarship question here</label>
            <textarea className="input mb2" style={{minHeight:180}} value={formText} onChange={e=>setFormText(e.target.value)} placeholder="Paste the form fields or questions here...&#10;&#10;Example:&#10;Student Name:&#10;High School:&#10;GPA:&#10;List your extracurricular activities..."/>
            <button className="btn btn-gold" onClick={analyzeForm} disabled={formLoading||!formText.trim()}>{formLoading?'Analyzing...':'ğŸ¤– Analyze & Fill Form'}</button>

            {formResult && (
              <div style={{marginTop:'1.5rem'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'0.5rem'}}>
                  <div className="section-label" style={{margin:0}}>Coach-Generated Answers</div>
                  <button className="btn btn-outline btn-sm" onClick={()=>{navigator.clipboard.writeText(formResult);toast('Copied!','success');}}>Copy All</button>
                </div>
                <div style={{background:'var(--white)',border:'1px solid var(--faint)',padding:'1.2rem',whiteSpace:'pre-wrap',fontFamily:'DM Mono,monospace',fontSize:'0.78rem',lineHeight:1.8}}>{formResult}</div>
              </div>
            )}
          </div>
        )}

        {tab==='essay' && (
          <div>
            <div className="mb2">
              <label className="label">Essay Type</label>
              <select className="select" value={essayType} onChange={e=>setEssayType(e.target.value)}>
                {['Common App Personal Statement (650 words)','Why This School Essay (250-650 words)','Scholarship Essay (varies)','Extracurricular Activity Description (150 chars)','Short Answer (100-250 words)'].map(t=><option key={t}>{t}</option>)}
              </select>
            </div>
            <div className="mb2">
              <label className="label">Essay Prompt (paste it here)</label>
              <textarea className="input" style={{minHeight:80}} value={essayPrompt} onChange={e=>setEssayPrompt(e.target.value)} placeholder="Paste the essay prompt or question here..."/>
            </div>
            <div className="mb2">
              <label className="label">Your Draft (optional â€” paste for feedback)</label>
              <textarea className="input" style={{minHeight:120}} value={essayDraft} onChange={e=>setEssayDraft(e.target.value)} placeholder="Paste your draft here to get specific feedback..."/>
            </div>
            <div style={{display:'flex',gap:'0.5rem',flexWrap:'wrap'}}>
              <button className="btn btn-gold" onClick={()=>getEssayHelp('outline')} disabled={essayLoading}>Get Outline</button>
              <button className="btn btn-primary" onClick={()=>getEssayHelp('review')} disabled={essayLoading||!essayDraft.trim()}>Review My Draft</button>
            </div>
            {essayLoading && <div className="mt2 mono" style={{fontSize:'0.65rem',color:'var(--gold)',letterSpacing:'0.1em'}}>Coach is thinking...</div>}
            {essayResult && (
              <div style={{marginTop:'1.5rem'}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'0.5rem'}}>
                  <div className="section-label" style={{margin:0}}>Coach Response</div>
                  <button className="btn btn-outline btn-sm" onClick={()=>{navigator.clipboard.writeText(essayResult);toast('Copied!','success');}}>Copy</button>
                </div>
                <div style={{background:'var(--white)',border:'1px solid var(--faint)',padding:'1.2rem',whiteSpace:'pre-wrap',fontSize:'0.88rem',lineHeight:1.75}}>{essayResult}</div>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}

// â”€â”€ ROOT APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const { toasts, toast } = useToast();
  const [config, setConfig] = useState(null);
  const [user, setUser] = useState(null);
  const [page, setPage] = useState('home');
  const [authLoading, setAuthLoading] = useState(true);

  useEffect(()=>{
    const url = localStorage.getItem('sm_url');
    const key = localStorage.getItem('sm_key');
    const coach = localStorage.getItem('sm_coach')||'';
    if(url&&key) {
      initSupabase(url,key);
      setConfig({url,key,coachUrl:coach});
      const sb = getSupabase();
      sb.auth.getSession().then(({data:{session}})=>{
        if(session?.user) setUser(session.user);
        setAuthLoading(false);
      }).catch(()=>setAuthLoading(false));
      sb.auth.onAuthStateChange((_,session)=>{
        setUser(session?.user||null);
      });
    } else setAuthLoading(false);
  },[]);

  const handleSetup = (cfg) => {
    setConfig(cfg);
    const sb = getSupabase();
    sb.auth.getSession().then(({data:{session}})=>{ if(session?.user) setUser(session.user); setAuthLoading(false); });
  };

  const [sidebarOpen, setSidebarOpen] = useState(false);
  const closeSidebar = () => setSidebarOpen(false);

  const signOut = async () => {
    await getSupabase().auth.signOut();
    setUser(null);
  };

  if(!config) return (<><ToastContainer toasts={toasts}/><SetupScreen onSetup={handleSetup}/></>);
  if(authLoading) return <div style={{minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center'}}><div className="typing"><span/><span/><span/></div></div>;
  if(!user) return (<><ToastContainer toasts={toasts}/><LoginScreen onLogin={setUser} toast={toast}/></>);

  const moduleProps = { user, toast, coachUrl: config.coachUrl };

  return (
    <div style={{display:'flex'}}>
      <ToastContainer toasts={toasts}/>
      <button className="hamburger" onClick={()=>setSidebarOpen(o=>!o)} aria-label="Menu">
        <span/><span/><span/>
      </button>
      <div className={`sidebar-overlay${sidebarOpen?' open':''}`} onClick={closeSidebar}/>
      <Sidebar page={page} onNav={(p)=>{setPage(p);closeSidebar();}} user={user} onSignOut={signOut} open={sidebarOpen}/>
      <div className="main-area" style={{flex:1}}>
        {page==='home'         && <HomeModule {...moduleProps} onNav={setPage}/>}
        {page==='library'      && <LibraryModule {...moduleProps} onNav={setPage}/>}
        {page==='vault'        && <VaultModule {...moduleProps}/>}
        {page==='tracker'      && <TrackerModule {...moduleProps}/>}
        {page==='achievements' && <AchievementsModule {...moduleProps}/>}
        {page==='financial'    && <FinancialModule {...moduleProps}/>}
        {page==='gpa'          && <GpaModule user={user} toast={toast}/>}
        {page==='coach'        && <CoachModule {...moduleProps}/>}
      </div>
    </div>
  );
}

class ErrorBoundary extends React.Component {
  constructor(p){super(p);this.state={err:null};}
  static getDerivedStateFromError(e){return{err:e};}
  render(){
    if(this.state.err) return (
      <div style={{fontFamily:'monospace',padding:'2rem',color:'#9a1a1a',background:'#faf7f2',minHeight:'100vh'}}>
        <h2>SloanMelia Error</h2>
        <p><strong>{this.state.err.message}</strong></p>
        <pre style={{fontSize:'0.75rem',whiteSpace:'pre-wrap'}}>{this.state.err.stack}</pre>
        <button onClick={()=>this.setState({err:null})} style={{marginTop:'1rem',padding:'0.5rem 1rem',cursor:'pointer'}}>Retry</button>
      </div>
    );
    return this.props.children;
  }
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<ErrorBoundary><App/></ErrorBoundary>);
</script>
</body>
</html>
